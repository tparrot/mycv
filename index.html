<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="description" content="Interactive CV" />
  <title>Loading CV…</title>

  <!-- External resources – for offline usage you can download these locally -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />

  <!-- We no longer use CryptoJS for encryption; instead we rely on the browser's Web Crypto API -->
  <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>

  <script src="https://d3js.org/d3.v7.min.js"></script>

  <style>
    /* ==========================================================================
       Base Colors, Layout, and Component Styles
       ========================================================================== */
    :root {
      --color-bg: #ffffff;
      --color-bg-hover: #f8f9fa;
      --color-text: #212529;
      --color-highlight: #FFB347;
      /* Orange base highlight */
      --color-muted: #6c757d;
      --color-skill-bubble: #FFE5D4;
      /* Light pastel orange */

      /* High Contrast Defaults */
      --hc-bg: #000;
      --hc-text: #fff;
      --hc-border: #fff;
      --hc-toast-bg: #000;
      --hc-toast-text: #fff;
      --hc-highlight: #fff;
      --hc-timeline-fill: #fff;
      --hc-position-outline: #fff;

      /* Orange to Purple Gradient Base */
      --highlight-base: #FFB347;
      --highlight-1: #FFB347;
      /* Orange */
      --highlight-2: #FFA76A;
      /* Orange-peach */
      --highlight-3: #FF9B8D;
      /* Peach */
      --highlight-4: #FF8FB0;
      /* Pink */
      --highlight-5: #FF83D3;
      /* Pink-purple */
      --highlight-6: #F377F6;
      /* Light purple */
      --highlight-7: #E66BF9;
      /* Purple */
      --highlight-8: #D95FFD;
      /* Deep purple */
      --highlight-9: #CC53FF;
      /* Brighter purple */
      --highlight-10: #BF47FF;
      /* Vivid purple */
      --highlight-11: #B23BFF;
      /* Rich purple */
      --highlight-12: #A52FFF;
      /* Deep purple */

      /* Category Colors */
      --category-education: #4a90e2;
      --category-work: #50c878;
      --category-volunteering: #ffa500;
      --category-text: #ffffff;
    }

    body {
      margin: 0;
      background: var(--color-bg);
      color: var(--color-text);
      font-family: "Helvetica Neue", Arial, sans-serif;
    }

    /* High Contrast Mode */
    body.high-contrast {
      font-size: 1.3rem !important;
      background-color: var(--hc-bg) !important;
      color: var(--hc-text) !important;
    }

    body.high-contrast #phone-link,
    body.high-contrast #email-link {
      font-size: 1.2rem !important;
    }

    body.high-contrast h5 {
      font-size: 1.9rem !important;
    }

    body.high-contrast h6,
    body.high-contrast h7 {
      font-size: 1.5rem !important;
    }

    body.high-contrast .btn,
    body.high-contrast .btn:hover {
      border-color: var(--hc-border) !important;
      color: var(--hc-text) !important;
      background: none !important;
    }

    body.high-contrast .card,
    body.high-contrast .list-group-item {
      background: var(--hc-bg) !important;
      color: var(--hc-text) !important;
      border-color: var(--hc-border) !important;
    }

    body.high-contrast .position-card {
      border-left-color: var(--hc-position-outline);
    }

    body.high-contrast #timeline-svg-container {
      background: var(--hc-bg) !important;
    }

    body.high-contrast #timeline-svg {
      background: var(--hc-bg) !important;
    }

    body.high-contrast #timeline-svg .tick {
      font-size: 2.5vw !important;
    }

    body.high-contrast .timeline-rect {
      fill: var(--hc-timeline-fill);
    }

    body.high-contrast #skill-tree-chart-container {
      height: auto !important;
    }

    body.high-contrast .skill-bubble {
      /*outline: 4px dashed var(--hc-border) !important;*/
      border: none !important;
      background-color: var(--hc-skill-bg) !important;
      color: var(--hc-text) !important;
      position: sticky !important;
      margin: 6px !important;
      float: left !important;
      left: 0px !important;
      top: 0px !important;
      width: max-content !important;
    }

    body.high-contrast #clipboard-toast {
      outline: 4px solid var(--hc-highlight) !important;
      background-color: var(--hc-toast-bg) !important;
      color: var(--hc-toast-text) !important;
      font-size: 1.3rem !important;
      font-weight: 600 !important;
    }

    body.high-contrast #clipboard-toast .btn-close {
      background-color: var(--hc-toast-bg) !important;
    }

    body.high-contrast .accomplishment-item.hovered a,
    body.high-contrast .skill-bubble.hovered,
    body.high-contrast .position-card.hovered {
      outline: 4px dashed var(--hc-highlight) !important;
      border-color: unset !important;
    }

    body.high-contrast .position-card .text-muted,
    body.high-contrast #skill-tree-legend,
    body.high-contrast #preferences-legend {
      color: var(--hc-text) !important;
    }

    body.high-contrast .highlighted {
      background-color: var(--hc-highlight-bg) !important;
      /* color: var(--hc-highlight) !important; */
    }

    body.high-contrast .copyable.btn:hover {
      background-color: var(--hc-highlight-bg) !important;
      color: var(--hc-highlight) !important;
      border-radius: 4px !important;
    }

    body.high-contrast .clipboard-btn {
      font-size: 1.5rem !important;
      color: var(--hc-highlight) !important;
      border-radius: 50%;
      outline: 2px solid var(--hc-border) !important;
    }

    body.high-contrast #skill-animation-switch {
      display: none !important;
    }

    /* Top Bar: Default layout */
    .top-buttons {
      align-content: stretch;
      flex-wrap: nowrap;
      flex-direction: row;
      align-items: normal;
    }

    .passphrase-input {
      max-width: 300px;
      min-width: 150px !important;
    }

    /* Toast Notification */
    #generic-toast {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1050;
      display: none;
    }

    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1050;
      display: none;
    }

    .toast.text-bg-gray {
      background-color: #6c757d;
      color: #fff;
    }

    .toast.text-bg-blue {
      background-color: #007bff;
      color: #fff;
    }

    .heatmap-rect {
      stroke: #fff;
      stroke-width: 2px;
    }

    /* Sidebar & Sticky Elements */
    aside {
      top: 0;
      z-index: 100;
    }

    @media (min-width: 768px) {
      aside {
        position: sticky;
        top: 0;
        z-index: 100;
      }
    }

    @media (max-width: 767px) {
      .mobile aside {
        position: static;
        /* or relative, depending on your layout */
      }

      .top-buttons {
        flex-wrap: wrap;
        justify-content: center;
      }

      #passphrase-container {
        width: 100%;
        justify-content: center;
        margin-top: 0.5rem;
      }
    }


    .portrait {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      overflow: hidden;
      background: var(--color-bg);
      margin: 0 auto 1rem auto;
    }

    .copyable.btn {
      cursor: pointer;
      position: relative;
      text-decoration: none;
      color: inherit;
    }

    .clipboard-btn {
      font-size: 1rem;
      cursor: pointer;
      display: inline;
      margin-left: 0.25rem;
      color: var(--color-muted);
      transition: transform 0.1s;
      padding: 4px;
    }

    .tooltip-custom {
      position: absolute;
      background: var(--color-highlight);
      color: #fff;
      padding: 2px 6px;
      border-radius: 4px;
      font-size: 0.8rem;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.2s;
      z-index: 100;
    }

    #phone-link,
    #email-link {
      max-width: 65%;
      word-break: break-all;
    }

    /* Position Cards */
    .position-card {
      border-left: 6px solid #ccc;
      margin-bottom: 1rem;
      transition: background-color 0.2s;
    }

    .position-card:hover {
      background-color: var(--color-bg-hover);
    }

    .list-group-item {
      background-color: unset !important;
    }

    .dimmed {
      opacity: 0.4 !important;
    }

    .highlighted {
      background-color: rgba(0, 0, 0, 0.05) !important;
    }

    #cv-timestamp {
      z-index: 100;
      position: relative;
    }

    /* Skill Tree */
    #skill-tree-chart-container {
      position: relative;
      min-height: 30vh;
      transition: height 0.2s;
      height: auto;
    }

    #skill-animation-switch {
      display: flex;
      flex-direction: row-reverse;
      align-content: center;
      justify-content: space-evenly;
      align-items: flex-start;
    }

    .skill-bubble {
      position: absolute;
      border-radius: 16px;
      padding: 4px 8px;
      /* background-color: var(--color-skill-bubble);*/
      color: #000;
      cursor: pointer;
      text-align: center;
      transition: opacity 0.2s, transform 0.2s;
      user-select: none;
      font-size: 14px;
    }

    .skill-bubble.hovered {
      outline: 2px solid var(--color-highlight);
      z-index: 10;
    }

    .skill-bubble.selected {
      border: 2px solid var(--color-highlight);
      background-color: var(--color-highlight);
      color: #fff;
      z-index: 120;
    }

    /* Timeline */
    img,
    svg {
      overflow: visible !important;
    }

    #timeline-svg-container {
      width: 100%;
      height: 25vh;
      position: sticky;
      top: 0;
      z-index: 90;
      /*box-shadow: 0 4px 4px -2px rgba(0,0,0,0.3);
      background: var(--color-bg);*/
      overflow: show;
    }

    #timeline-svg {
      width: 100%;
      height: 100%;
      position: relative;
      top: -20px;
      overflow-y: visible;
    }

    .timeline-rect {
      cursor: pointer;
      transition: opacity 0.2s, transform 0.2s;
      fill-opacity: 0.8;
    }

    .timeline-rect:hover {
      fill-opacity: 1;
    }

    .timeline-label {
      font-family: sans-serif;
      font-size: 12px;
      fill: var(--color-text);
    }

    .timeline-category {
      font-family: sans-serif;
      font-size: 14px;
      font-weight: bold;
      fill: var(--color-text);
    }
    #timeline-card h5 {
      z-index: 100;
      position: relative;
    }

    body.high-contrast .timeline-label,
    body.high-contrast .timeline-category {
      fill: var(--hc-text);
      font-size: 16px;
    }

    /* Accomplishments */
    .accomplishment-item {
      position: relative;
      display: flex;
      margin-bottom: 0.25rem;
      padding: 0.25rem 0.5rem;
      background: none;
      border: none;
      transition: background-color 0.2s;
      flex-wrap: wrap;
      flex-direction: row;
      justify-content: space-between;
      align-items: center;
      align-content: center;
    }

    .accomplishment-item.has-attachment {
      padding: 0;
      margin-bottom: 0.5rem;
    }

    .accomplishment-item.has-attachment .btn-accomplishment {
      width: 100%;
      text-align: left;
      padding: 0.5rem 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: none;
      border: 1px solid var(--color-muted);
      color: inherit;
      transition: all 0.2s ease;
    }

    .accomplishment-item.has-attachment .btn-accomplishment:hover {
      background-color: var(--color-bg-hover);
      border-color: var(--color-highlight);
    }

    .accomplishment-item.has-attachment .btn-accomplishment i {
      opacity: 0.6;
      transition: opacity 0.2s;
    }

    .accomplishment-item.has-attachment .btn-accomplishment:hover i {
      opacity: 1;
    }

    body.high-contrast .accomplishment-item.has-attachment .btn-accomplishment {
      border-color: var(--hc-border);
    }

    body.high-contrast .accomplishment-item.has-attachment .btn-accomplishment:hover {
      background-color: var(--hc-highlight);
      color: var(--hc-bg);
    }

    @media (max-width: 1199px) {
      .accomplishment-item {
        justify-content: center;
        flex-flow: column;
      }
    }

    .accomplishment-item a .btn {
      min-width: fit-content;
    }

    .accomplishment-item span {
      text-align: center;
    }

    .accomplishment-item:hover {
      background-color: var(--color-hover);
    }

    .accomplishment-item.hovered {
      background-color: var(--color-hover);
    }

    .clipboard-icon {
      visibility: hidden;
      color: var(--color-muted);
      font-size: 1rem;
      margin-left: 0.5rem;
      transition: transform 0.1s;
    }

    .accomplishment-item:hover .clipboard-icon {
      visibility: visible;
    }

    .accomplishment-item:active .clipboard-icon {
      transform: scale(0.95);
    }

    /* Print Styles */
    @media print {
      @page {
      size: A4;
      margin: 1cm;
      }

      html, body {
      width: 210mm;
      height: 297mm;
      font-size: 11pt;
      margin: 0;
      padding: 0;
      -webkit-print-color-adjust: exact;
      print-color-adjust: exact;
      }

      /* Force widest Bootstrap scaling for print */
      .container {
      width: 100% !important;
      max-width: 100% !important; /* Ensure full width for print */
      margin: 0 auto !important;
      padding: 1rem !important; /* Add padding for better alignment */
      overflow: visible !important;
      }

      .row {
      display: flex !important;
      flex-direction: row !important;
      width: 100% !important;
      margin: 0 !important;
      }

      aside {
      width: 40% !important;
      float: left !important;
      margin: 0 !important;
      padding-right: 1rem !important;
      overflow: visible !important;
      }

      main {
      width: 60% !important;
      float: right !important;
      margin: 0 !important;
      padding-left: 1rem !important;
      overflow: visible !important;
      }

      /* Skills visualization */
      #skill-tree-chart-container {
      display: block !important; /* Ensure block layout for print */
      height: auto !important;
      min-height: 30vh !important; /* Set a minimum height */
      overflow: visible !important;
      margin: 0 auto !important; /* Center align */
      }

      .skill-bubble {
      position: static !important;
      display: inline-block !important;
      margin: 4px !important;
      transform: none !important;
      page-break-inside: avoid !important;
      }

      /* Preferences visualization */
      .preferences-container {
      width: 50% !important;
      height: auto !important;
      overflow: visible !important;
      page-break-inside: avoid !important;
      }

      .preferences-treemap,
      .preferences-bar-chart {
      width: 100% !important;
      height: auto !important;
      overflow: visible !important;
      transform: scale(0.7) !important;
      position: relative !important;
      left: -3rem !important;
      }

      /* Prevent unwanted breaks */
      .position-card,
      .card,
      .accomplishment-item {
      page-break-inside: avoid !important;
      break-inside: avoid !important;
      margin-bottom: 1rem !important;
      }

      /* Hide interactive elements */
      .top-buttons,
      #preferences-view-switch,
      #timeline-card,
      #generic-toast,
      .toast,
      .clipboard-btn,
      #skill-animation-switch,
      .bi.btn,
      .accomplishment-item > .btn > i {
      display: none !important;
      }
    }

    .preference-axis path {
      display: none;
    }

    .preference-axis text {
      font-size: 12px;
    }

    .preference-bar {
      transition: opacity 0.3s;
    }

    .preference-bar:hover {
      opacity: 0.8;
    }

    .preference-label {
      font-size: 12px;
      fill: var(--color-text);
    }

    body.high-contrast .preference-bar {
      stroke: var(--hc-text);
      stroke-width: 2px;
    }

    body.high-contrast .preference-label {
      fill: var(--hc-text);
      font-size: 14px;
    }

    body.high-contrast .preference-focus {
      background: var(--hc-bg);
      color: var(--hc-text);
      border: 2px solid var(--hc-border);
    }

    body.high-contrast .preference-bar {
      stroke: var(--hc-text);
      stroke-width: 2px;
    }

    body.high-contrast .preference-label {
      fill: var(--hc-text);
      font-size: 14px;
      font-weight: bold;
    }

    body.high-contrast #preferences-tooltip,
    body.high-contrast #timeline-tooltip {
      background: var(--hc-bg);
      color: var(--hc-text);
      border: 2px solid var(--hc-border);
    }

    /* Add new styles for preferences */
    #preferences-view-switch {
      display: flex;
      flex-direction: row-reverse;
      align-content: center;
      justify-content: space-evenly;
      align-items: flex-start;
      margin-top: 10px;
      padding: 5px;
      border: 1px solid var(--color-muted);
    }

    body.high-contrast #preferences-view-switch {
      border: 2px solid var(--hc-border);
      background: var(--hc-bg);
    }

    .preferences-bar-chart-container {
      padding: 0px 20px;
    }

    .preferences-bar-chart {
      width: 100%;
      height: auto;
    }

    .preference-bar-rect {
      fill: var(--color-highlight);
      transition: opacity 0.3s;
    }

    .preference-bar-rect:hover {
      opacity: 0.8;
    }

    .preference-bar-label {
      font-size: 12px;
      fill: var(--color-text);
    }

    body.high-contrast .preference-bar-rect {
      fill: var(--hc-highlight);
      stroke: var(--hc-text);
      stroke-width: 2px;
    }

    body.high-contrast .preference-bar-label {
      fill: var(--hc-text);
      font-size: 14px;
      font-weight: bold;
    }

    /* Remove the high contrast display none for preferences switch */
    body.high-contrast #preferences-view-switch {
      /* Let it be visible in high contrast mode */
      border: 2px solid var(--hc-border);
      padding: 5px;
      margin-top: 15px;
    }

    body.high-contrast #preferences-view-switch label {
      color: var(--hc-text);
    }

    /* Update preferences styles */
    .preferences-treemap rect {
      fill: var(--color-bg);
      rx: 4px;
      ry: 4px;
      filter: drop-shadow(0 .125rem .25rem rgba(0, 0, 0, .075));
      transition: all 0.3s ease;
    }

    .preferences-treemap rect:hover {
      filter: drop-shadow(0 .5rem 1rem rgba(0, 0, 0, .15));
    }

    .preferences-treemap text {
      font-family: inherit;
      font-size: 0.875rem;
      fill: var(--color-text);
      pointer-events: none;
    }

    .preferences-treemap .text-container {
      padding: 0.5rem;
      width: 100%;
      height: 100%;
      overflow: hidden;
      word-wrap: break-word;
      font-size: 0.875rem;
      line-height: 1.2;
      text-overflow: ellipsis;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      color: inherit;
    }

    body.high-contrast .preferences-treemap rect {
      fill: var(--hc-bg);
      stroke: var(--hc-text);
      stroke-width: 2px;
    }

    body.high-contrast .preferences-treemap text {
      fill: var (--hc-text);
      font-weight: bold;
    }

    /* Preferences visualization styles */
    .preferences-container {
      width: 100%;
      height: auto;
    }

    .preferences-bar-group {
      transition: transform 0.2s ease;
    }

    .preferences-bar-text {
      font-family: inherit;
      font-size: 0.875rem;
      margin-left: 5px;
      dominant-baseline: middle;
    }

    .preferences-treemap-cell {
      transition: all 0.3s ease;
    }

    .preferences-treemap-cell:hover {
      filter: drop-shadow(0 .5rem 1rem rgba(0, 0, 0, .15));
    }

    .preferences-text-wrapper {
      display: grid;
      align-items: center;
      justify-content: center;
      text-align: center;
      height: 100%;
      /*padding: 0.5rem;*/
      font-size: 0.875rem;
      line-height: 1.2;
      overflow: show;
      overflow-wrap: anywhere !important;
      word-wrap: break-word;
    }

    /* Update existing treemap styles */
    .preferences-treemap rect {
      rx: 4px;
      ry: 4px;
    }

    /* Add these styles in the style section */
    .category-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .category-badge.education {
      background-color: var(--category-education);
      color: var(--category-text);
    }

    .category-badge.work {
      background-color: var(--category-work);
      color: var(--category-text);
    }

    .category-badge.volunteering {
      background-color: var(--category-volunteering);
      color: var(--category-text);
    }

    body.high-contrast .category-badge {
      border: 1px solid var(--hc-border);
    }

    /* Add new styles for treemap interaction */
    .preferences-treemap-cell {
      transition: all 0.3s ease-in-out;
      cursor: pointer;
    }

    .preferences-legend {
      text-align: center;
      color: var(--color-muted);
      font-size: 0.875rem;
      margin-top: 0.5rem;
    }

    /* Update button animation utility class */
    .btn-animate {
      transition: transform 0.1s ease-in-out;
    }

    .btn-animate:active {
      transform: scale(0.95);
    }

    /* Add fixed button sizes */
    .top-buttons .btn {
      max-width: 140px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* Button tooltip */
    .btn[data-full-text]:hover::after {
      content: attr(data-full-text);
      position: absolute;
      bottom: 100%;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.8);
      color: white;
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 14px;
      white-space: nowrap;
      z-index: 1000;
    }

    /* Timeline tooltip styles */
    #timeline-tooltip {
      position: absolute;
      pointer-events: none;
      opacity: 0;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px;
      border-radius: 4px;
      font-size: 14px;
      z-index: 1000;
      transition: opacity 0.2s;
    }

    body.high-contrast #timeline-tooltip {
      background: var(--hc-bg);
      color: var(--hc-text);
      border: 2px solid var(--hc-border);
    }

    /* Add preferences tooltip styles */
    #preferences-tooltip {
      position: absolute;
      pointer-events: none;
      opacity: 0;
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 8px;
      border-radius: 4px;
      font-size: 14px;
      z-index: 1000;
      transition: opacity 0.2s;
    }

    body.high-contrast #preferences-tooltip {
      background: var(--hc-bg);
      color: var(--hc-text);
      border: 2px solid var(--hc-border);
    }

    .top-buttons-group {
      display: inline-flex;
    }

    /* Passphrase container styling */
    #passphrase-container {
        justify-content: flex-start;
        width: fit-content;
    }
    #toggle-container {
        justify-content: flex-end;
        width: fit-content;
    }


    /* Action buttons styling */
    .action-btn {
        min-width: 140px;
        max-width: fit-content;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    #lang-toggle {
        text-overflow: ellipsis;
        max-width: 180px;
    }

    #contrast-toggle {
        text-overflow: ellipsis;
        max-width: 200px;
    }

    #print-btn {
        text-overflow: clip;
        min-width: 100px;
    }

    @media (max-width: 768px) {
        .top-buttons {
            justify-content: center;
        }

        #passphrase-container {
            flex: 0 0 100%;
            max-width: 100%;
            order: -1;
            margin-bottom: 0.5rem;
        }

        .action-btn {
            flex: 1 1 auto;
        }
    }
  </style>
</head>

<body>
  <!-- Toast Notification -->
  <div id="generic-toast" class="toast align-items-center text-bg-success border-0" role="alert" aria-live="assertive"
    aria-atomic="true">
    <div class="d-flex">
      <div class="toast-body" id="generic-toast-text"></div>
      <button type="button" class="btn-close btn-close-white me-2 m-auto"></button>
    </div>
  </div>

  <!-- Timeline tooltip container - add before the main container -->
  <div id="timeline-tooltip"></div>
  <div id="preferences-tooltip"></div>

  <!-- Main Container -->
  <div class="container">
    <!-- Top Buttons (including the new passphrase input group) -->
    <div class="top-buttons p-3">
      <!-- Passphrase Unlock UI -->
      <div id="passphrase-container" class="top-buttons-group input-group mb-3">
        <input type="password" id="passphrase-input" class="form-control passphrase-input" placeholder=""
          data-i18n="passphrase_prompt" />
        <div class="input-group-append">
          <button id="toggle-passphrase" class="btn btn-outline-secondary" type="button">
            <i class="bi bi-eye"></i>
          </button>
          <button id="passphrase-submit" class="btn btn-outline-primary" type="button" data-i18n="passphrase_submit">
          Unlock
          </button>
        </div>
      </div>
      <div id="toggle-container" class="top-buttons-group input-group mb-2">
      <button id="lang-toggle" class="btn btn-outline-primary action-btn" onclick="toggleLanguage()" data-i18n="lang_toggle">
      </button>
      <button id="contrast-toggle" class="btn btn-outline-primary action-btn" onclick="toggleContrast()" data-i18n="contrast_toggle">
      </button>
      <button id="print-btn" class="btn btn-outline-primary action-btn" onclick="window.print()" data-i18n="print">
        Print
      </button>
      </div>
    </div>
    <div id="cv-timestamp" class="text-end small mb-2"></div>
    <div class="row g-3">
      <!-- LEFT SIDEBAR: Personal Info, Skill Tree, Certificates -->
      <aside class="col-md-4">
        <!-- Personal Info Card -->
        <div class="card mb-3">
          <div class="card-body text-center">
            <div class="portrait">
              <img id="portrait-image" alt="Portrait Picture" style="width: 100%; height: 100%" />
            </div>
            <h2 class="card-title h4">
              <span class="copyable" data-copy="" data-i18n="name"></span>
              <i class="bi bi-clipboard btn clipboard-btn"></i>
            </h2>
            <p class="card-text" data-i18n="title"></p>
            <p>
              <i class="bi bi-geo-alt"></i>
              <span data-i18n="birthplace"></span>
            </p>
            <p>
              <i class="bi bi-calendar-event"></i>
              <span data-i18n="dob"></span>
            </p>
            <p>
              <i class="bi bi-telephone"></i>
              <a href="#" id="phone-link" class="copyable btn btn-light btn-sm" data-copy="" data-i18n="phone"></a>
              <i class="bi bi-clipboard btn clipboard-btn"></i>
            </p>
            <p>
              <i class="bi bi-envelope"></i>
              <a href="#" id="email-link" class="copyable btn btn-light btn-sm" data-copy="" data-i18n="email"></a>
              <i class="bi bi-clipboard btn clipboard-btn"></i>
            </p>
            <p>
              <i class="bi bi-globe"></i>
              <span data-i18n="languages"></span>
            </p>
          </div>
        </div>
        <!-- Skill Tree Card -->
        <div class="card mb-3">
          <div class="card-body">
            <h5 class="text-center" data-i18n="skills"></h5>
            <div id="skill-tree-chart-container"></div>
            <p id="skill-tree-legend" class="text-center text-muted small mt-2" data-i18n="skills_legend">
            </p>
          </div>
        </div>
        <!-- Personal Preferences Card -->
        <div class="card mb-3">
          <div class="card-body">
            <h5 class="text-center" data-i18n="preferences"></h5>
            <div id="preferences-chart-container"></div>
            <p id="preferences-legend" class="text-center text-muted small mt-2" data-i18n="preferences_legend"></p>
          </div>
        </div>
        <!-- Certificates & Accomplishments Card -->
        <div class="card">
          <div class="card-body">
            <h5 class="text-center">Certificates &amp; Accomplishments</h5>
            <div id="accomplishments-list" class="mt-2"></div>
          </div>
        </div>
      </aside>
      <!-- RIGHT COLUMN: Timeline & Positions -->
      <main class="col-md-8" style="overflow-y: auto; min-height: calc(100vh - 60px)">
        <div id="timeline-card" class="mb-2">
          <h5 class="text-center" data-i18n="timeline"></h5>
          <div id="timeline-svg-container">
            <svg id="timeline-svg"></svg>
          </div>
        </div>
        <div id="position-list"></div>
      </main>
    </div>
    <!-- Extra Content Container (if needed) -->
    <div id="extra-content-container" class="mt-3"></div>
  </div>

  <!-- Embedded Default YAML Configuration -->
  <script id="default-config" type="text/x-yaml">
      page_title: "DevOps Engineer CV for John Doe"
      cv_timestamp: "2025-03-13"
      personal_info:
        name: "John Doe"
        title: "DevOps Engineer"
        birthplace: "New York, USA"
        dob: "1980-01-01"
        phone: "+1 123-456-7890"
        email: "john.doe@example.com"
        #image: "https://img.freepik.com/fotos-kostenlos/die-rote-oder-weisse-katze-ich-auf-weissem-studio_155003-13189.jpg?semt=ais_hybrid"
        languages: "English, German"
        email_tooltip_en: "Click to send mail"
        email_tooltip_de: "Mail senden"
        phone_tooltip_en: "Click to call"
        phone_tooltip_de: "Anrufen"

      positions:
        - id: "devops"
          category: "work"
          color: "#b3cde0"
          translations:
            en:
              title: "DevOps Engineer"
              company: "DevOps Company (former DEVYOPY.org)"
              description:
                - type: paragraph
                  text: "Implemented CI/CD via GitHub, automated monitoring with OpsGenie and CloudWatch. And generally following parts:"
                - type: list
                  items:
                    - "Designed service and infrastructure architecture"
                    - "Practiced Scrum"
                    - "Used Terraform and AWS"
                - type: paragraph
                  text: "And much more."
            de:
              title: "DevOps Engineer"
              company: "DevOps Company (früher DEVYOPY.org)"
              description: "Implementierung von CI/CD über GitHub Enterprise, automatisierte Überwachung mit CloudWatch, Planung und Umsetzung von Service- und Infrastrukturlösungen, Scrum, Terraform und AWS."
          start: "2016-08"
          end: "2023-03"
          skills: ["AWS", "CI/CD", "Kubernetes"]
        - id: "apprenticeship"
          category: "work"
          color: "#ccebc5"
          company: "Company org, Rivertown"
          translations:
            en:
              title: "Apprenticeship as a Systems Engineer"
              description: "Focused on observability, logging, and automation."
            de:
              title: "Duale Ausbildung Fachinformatiker für Systemintegration"
              description:
                - type: paragraph
                  text: 'Fokussiert auf Monitoring, Logging und Automatisierung'
                - type: list
                  items:
                    - "Weiterbildung in Linux und Windows"
                    - "Gemeinsame Projektarbeit and Terminalservern"
                - type: paragraph
                  text: 'Ich erreichte einen erfolgreichen Abschluss nach verkürzter Ausbildungszeit'
          start: "2013-08"
          end: "2016-07"
          skills: ["Monitoring", "Bash", "Linux", "networking"]
        - id: "volunteering"
          category: "volunteering"
          color: "#fbd9a4"
          translations:
            en:
              title: "Early volunteer work"
              description: "Even as a youngster, I was involved in the local chapter of the German Red Cross."
            de:
              title: "Frühe ehrenamtliche Arbeit"
              description: "Schon als Jugendlicher habe ich im Ortsverein des Deutschen Roten Kreuzes mitgewirkt."
          start: "2000-05"
          end: "2016-07"
          skills: ["social", "empathy", "responsibility"]
        - id: "secondary"
          category: "education"
          color: "#ebd9f4"
          translations:
            en:
              title: "Secondary School"
              description: ""
            de:
              title: "Realschule"
              description: ""
          start: "2001-08"
          end: "2007-07"
          skills: []
        - id: "elementary"
          category: "education"
          color: "#f4e8d9"
          translations:
            en:
              title: "Elementary School"
              description: ""
            de:
              title: "Grundschule"
              description: ""
          start: "1995-08"
          end: "2001-07"
          skills: []
      skills:
        - id: "AWS"
          level: 10
          positions: ["devops"]
        - id: "Linux"
          level: 12
          positions: ["apprenticeship", "admin"]
        - id: "networking"
          level: 4
          positions: ["apprenticeship", "admin"]
          translations:
            en:
              title: "Networking"
            de:
              title: "Netzwerktechnik"
        - id: "Bash"
          level: 10
          positions: ["apprenticeship", "admin"]
        - id: "social"
          level: 7
          positions: ["apprenticeship", "volunteering"]
          translations:
            en:
              title: "Social Interaction"
            de:
              title: "Sozialkompetenz"

      accomplishments:
        - label: "volunteering"
          positions: ["volunteering"]
          skills: ["empathy", "social"]
          attachment: "certificate-volunteering.pdf"
          translations:
            en:
              label: "Volunteering Year Certificate"
            de:
              label: "FSJ-Bescheinigung"
        - label: "lpic1"
          positions: ["apprenticeship"]
          skills: ["linux", "bash", "networking"]
          attachment: "certificate-medical.pdf"
          translations:
            en:
              label: "LPIC-1 Zertifizierung"
            de:
            label: "LPIC-1 Zertifizierung"
        - label: "elementaryschoolcertificate"
          positions: ["elementary"]
          skills: ["music", "painting", "dancing"]
          attachment: "es-cert.pdf"
          translations:
            en:
              label: "Elementary School Certificate"
            de:
              label: "Grundschulabschlusszeugnis"

      preferences:
        - id: "remote_work"
          level: 8
          translations:
            en: "Remote Work"
            de: "Fernarbeit"
        - id: "team_collaboration"
          level: 7
          translations:
            en: "Team Collaboration"
            de: "Teamarbeit"
        - id: "flexible_hours"
          level: 9
          translations:
            en: "Flexible Hours"
            de: "Flexible Arbeitszeiten"
        - id: "learning_opportunities"
          level: 10
          translations:
            en: "Learning Opportunities"
            de: "Lernmöglichkeiten"

      translations:
        en:
          timeline: "My Timeline"
          skills: "My Mix of Skills"
          skills_legend: "Larger skill tags indicate higher expertise/experience."
          clipboard_copied: "Copied to clipboard"
          skill_filter_toast: "Showing positions with skill: {skill}"
          skill_filter_clear_toast: "Skill filter removed"
          lang_toggle: "Deutsche Version"
          contrast_toggle: "Accessibility Toggle"
          print: "Print"
          passphrase_submit: "Unlock"
          passphrase_prompt: "Enter passphrase"
          passphrase_required: "Passphrase is required to decrypt configuration."
          decryption_failed: "Decryption failed: {error}"
          decryption_error: "Decryption error: {error}"
          decryption_success: "Configuration unlocked successfully!"
          disable_skill_animation: "Static Layout"
          empty_decryption_result: "Empty decryption result. Possibly an incorrect passphrase."
          invalid_key_material: "Key material is not a CryptoKey"
          yaml_parse_failed: "YAML parsing failed: {error}"
          viewing_example_cv: "You are viewing an example CV. Please provide passphrase to view personal data."
          open_file: "Open file"
          preferences: "Personal Preferences"
          preferences_legend: "Display of personal work related preferences."
          timeline_position: "Position"
          timeline_from: "From"
          timeline_to: "To"
          category_education: "Education"
          category_work: "Work"
          category_volunteering: "Volunteering"
        de:
          timeline: "Mein Lebenslauf"
          skills: "Meine Fähigkeiten"
          skills_legend: "Größere Skill-Tags deuten auf höhere Expertise/Erfahrung hin."
          clipboard_copied: "Kopiert!"
          skill_filter_toast: "Zeige Positionen mit {skill}"
          skill_filter_clear_toast: "Skillfilter entfernt"
          lang_toggle: "English Version"
          contrast_toggle: "Barrierefreiheit umschalten"
          print: "Drucken"
          passphrase_submit: "Öffnen"
          passphrase_prompt: "Passwort eingeben"
          passphrase_required: "Passphrase ist erforderlich, um die Konfiguration zu entschlüsseln."
          decryption_failed: "Entschlüsselung fehlgeschlagen: {error}"
          decryption_error: "Entschlüsselungsfehler: {error}"
          decryption_success: "Konfiguration erfolgreich freigeschaltet!"
          disable_skill_animation: "Statische Ansicht"
          empty_decryption_result: "Leeres Ergebnis der Entschlüsselung. Möglicherweise ist das Passwort falsch."
          invalid_key_material: "Schlüsselmateriel ist kein CryptoKey"
          yaml_parse_failed: "YAML-Parsing fehlgeschlagen: {error}"
          viewing_example_cv: "Sie sehen einen Beispiel-Lebenslauf. Bitte geben Sie das Passwort ein, um persönliche Daten anzuzeigen."
          open_file: "Datei öffnen"
          preferences: "Persönliche Vorlieben"
          preferences_legend: "Darstellung von arbeitsbezogenen, persönlich bevorzugten Themen."
          timeline_position: "Position"
          timeline_from: "Von"
          timeline_to: "Bis"
          category_education: "Ausbildung"
          category_work: "Arbeit"
          category_volunteering: "Ehrenamt"
        </script>
  <script id="custom-config" type="text/plain">
{"salt":"t3s5BfXtyGkJctRmBpoL5g==","iv":"ehz3EW3C1Yux6Zah","ciphertext":"GQ6lf87OnJASs1wx5srG1Aw1iIs0bdODxcJmJn67AlpJUoRcAt3WvQr94qAkz/zWbXta0AYCKIQSJEqGkUn5EojpUge9LZ8rdRp4sMEqtWUDnHvYDCvdcmTqXwq6kD7WZYD2oY9bOEsfD7QAL88rUQIPSjFEvwTGOpKOHe7fQsXld2gRkjv0ityBg03XLxDpswXuDbHnL5UU3JbOE77BS6TebRSz6Hyiiq9YbY0I4cuGeM5y/nJp3mmcnRkms0NttUXSW4xArdhKX7bSQcPZjHMw2gqhoI058L88gx58kvQ0pd78uPDNDWXFQvOY6kGG+8IK439WHExUYHxBeN0h0ZPCnGX0gOfbcXBTO68o6zh/kz+Vo91SHN5uPLK+4cm/XKGY2k/o0WcpzRSpKgNrDfERF1LxKxsS64xLxUas8Amj1kBtYe09pqF6bXdXRHtZ5Y+8H95LrBaNclzEm9GVoUKGhLcBMkc5Oz7E8ssKVVxDfdqv5CImjunFxCX/tH4VWt5DU1kjfJ0JpSr6l5zXnNXcNUkfifEm6H6gmVnFHxGbJ1Ba+LKAIT5Z6uH2Uyq3GZZ0Fz8xwx4qqW3sX+rDi/nzz4FbwuH0czaM3daZtTdg/m0MtJuDahrS2drONagg3wEohy9b9qQjp8Yd6kST0N90Qce55YB6Kln1Ws1evxFtFxH28y81HAoLmdhSSnuPsdYx+I/vY/YPw43pUO4ikd8W32iIAnw5aohhYarxFd3+oeKjfpxAQ2O8TuydZEk+VRhzEc9bfH52mm9WKAiQL9g8tHC5Ky9Iuxe+fvJ//z0TAuss1e51fKAfvi0T9rt9Fd2GmcrpPWdQTfZz+Hd9s8e1TuRBrhflKAGTc8b5SgFX/1334J8Qxpldkw4jGG0hrZOdWkwpsIA8jhgSaPwvOmkF/nw98P7pu5qyFUqoyrC30HfI40kYmEQEkSvpJjyzZu3sbV2XUK/zvTmMwYaTtTTyQnY6hEq1Yhf0ne4h9Lictd2cahgawtHCcUw5Mnlnxz06ivUPGJw729ld5wau/GqCFe8PWfx6RnFU3UHdUlXDr9l3AoH5fwu/WgrYjspxUhflTww6b562QaWFIcDj4cNbwflUaWrs6C8j5vEAzMQTOlzjq4Uo0h4lKLzscrVjx7dQq9WlaZote5imHh5O07TDb+9gv5JcYCs8jw9ZYvZz59pqnPxWDkZsYw9vpFxxWNgFZz8LpHq3NapM9yqTOM203c2KmagWc1m+fRWIgsm2yj8VWDkD6xq2Cz+TWJPFstOExPZ1/FUTSCwB72fT9QWb33U+CHDiVurSV/QmYlCMKcnsHNJ5viZx1MV5oi/xkUr7Naxt3UwGNhOkAE/q29zsSgoFML4u6nUE/V5n0CI4o6GHdelDPo//Y4qhes2kqFBfad6os8CNw4bZaKDbjrdYnSB6OBIxBqfHB+ZPtHYZtynaE50273tYVAJ/zxVNwq3i15p+iR4ommEGV4bBViJG65R8++UZi0EQmUpikRf9w9tWDEZY4EJvyWERAPdXxkWrAnHuPvV9ktD8KYAY20HMCL8/jAebyEusPTzMNOkrQhM1MeB4Lp1zA/P+5PZNYRfXA52RItCX+d1X/dWxl4ipkBZfC1HPu4DWiUO8Uf3iOBFibGRKQwkdScvlUzTM4h63JXB42Kd6d7ydWadPtSq8k/ujBGQW2yg6F7kq9ZbkS3KNHmFCtXs1c4h3MHIFo4cvPYKUxMLeh/H5l/uMwfZlgiDvXVXyKqmfR5WqLTsLtOYI7YPL9P+smw0QI7nCci+0UkIjnJkp2FZvBkplCLCGTs4G0YsuOi2J5iw+/E5wNk9qLkjtBrN6/Bm7INuxz8egnLCat3rf9QYpPIBbcQpW2QzJW9Q1RLI2jhIxRSAiKK4a13MlrINVN4h85aVDEZ+uj4W/YAOX6Iu0i7hkKml4OKNaCZ8ubVXUc2k+Go79HJSQfIYFIAeZi92jpXPXN3qKJitSogfzAs6MqwGTXePUoyhpOTUzhxGzy6qwD2XdKrpicSSot8EBuuECwWN3a9yUlrxy2qXpsroCL1dv3w74vAM9vvSLD5+sOxioZqKwhlLpIFs/BztNv+G9U0wkeYHAyDLztYSbbOPaCSWKPwgf8qp6ZPzHn6JotS7hUGLsuPLVotvZREnO15mZhKZI9Z/FqHOsuhbvBGso0pisWbt+l3AC9fq15mXlm6SWWM0r+wTxXku04qqgPbVDLVyDpU5iYbiQYJiRnArZOW2PpgBgWYS+0b7N+f/8VIB+h3+sOOBlkLSq9+3QyxZ5KKynDNvJEtW3wAjG/HgsY8IB4PaG78vyJqEZGhmLdV9k3GXnfWHWEBKRAklYZ9h9K1WX01LjCRidgNs9HTkjjgFahPpg6fKesPbqIqEyBTK+ip5YeiQYxzVGuYGszzh5CrA6N0gEN2n3C56fJQvAqEI9UnZlHIivMGcXg2neKI2bJYAbiMqtUuQUG8UgcCcKBdQaHANgeiWzmQYJwFqxUvtsbZ8EtATsaFyXlNVIBgRp5gomcJOj08RnGbk22ER+4H5x1Ak+1Z9/1Y1efTwr3d5yc5M0ZGQhm1FyvunE6nbFMESv5ddt0lz8gUb1hbYiX0hucJwBrV1HbJ2u35TO+mTBFxbca54TzCjSd4/M9rdY+sc9CDhGl9CgxT20fNmOeWEXltpDyADlwQnOw2gdNTAWjXf3a0MoENkCzM0aAGHDCjKCjgW0devVlCieJ0m9EjBbFcz5O9rkQsLZ4dRPwFHVs7xRNk62N6AIFBlIshtx+dirDhhm09cbtQ9N+yHuUDjAvZaFnYIEdH7WDBproS6MyeZt/3txcYTlSlxxxOSpb5ZfrN/ZgdBL7SMv67+U//Ng5KCA7uV4Z2b/9fd/fX+y+VwHOix6g9B24V4+JNnoivfgERyPwQdsLbovytFDBnOrIT0QHCIJaxcD6cRixIQ8iS9og4Fr1jhCDE8Z3lQCUu0wqL/fCIfBdVlcWcChJrnQ8T4BP2XoOaG4I/3AKc7iWNb37C0MLSA7SWYJ6UXt/DjafARUPg2quMazJAzM7MsBfhmZUKN1O2ITZz6hgH6vKyx+mNC/ZqeMCmIgOkjdWpKaB6KdLCscOQuybZL8U5dJxwTMjhzM8tTg9R08f0LoxOk+3OpAuE8CfnxwzzbP6Yz3Rc7Twla1kbCSZFtEFcuimOYKdU89YvTStIRh+QEK5j0T6zzku7gEKZtsJToZNFP2VPZsEbE32dsTSyqokMdESsf/vltACeiBDxPDA9mFL0DSH2r9jkpN0TzJfyuvFmvBL/wNSIVIUjnrXSLrtV21LtiK+P2CCJbOGAQqJb8cnGyNeNuUKKE7qawusbSiD/HaWfhHPGbls4yHaGC1a73cAXtErYcT121kBbTFc1GSy1yFHa09eHmz5skRR5P1HCIqR6svH8rv6cHqiHLoMgFsFRb+XQYny07ZG/z5LUoDb/sBKODh+oX6WFEL4yE95K7m0gUVFSbthrGW43wRIWxGmmPnVBjonOQIU4FYF/eIGXSjl9XAOTNRmK8tlxa4yAm0bmJoBRvYMboQ599A/yTbEp8hN/9tKW+Co99rKHHjC2mUJt8R1eCVppJ3H3lPYy0TbRAJ3v2fJc/yqzidTITtss2IdvU0fCwQFPouhdOc891nKxSxQ21Ttv/WfWyFXkdP8xv/+/ssi3wNq4Hzj3hK58egi1ojasArSfJmYAcBIeIZAZ+49yZMQiMbcYYRMAyRgIom8vB1jCFQu5QaSaHxc/wsrgoeRimU8cNcKQ8jIDzDDQgkbaWa0u2ZSRJM18LpAMQAjuP7Jiawtm3lNWOi8A1roWfMtRE83QQ0mi2wwm0n3ifAyj0ivMGnxGSr7TEo4bS5+nYEzrV2QZog6ASheMxe7+kiEbzm8LGg4KH9gnSdIRwd6iAFpfZ8jecvd+vAjFeb2lerkGReDeKsNT4aBBL5gUmUmak+Lhjz32KNAtlTco+FTuMF0hZwHPwElh4Hs405buTzyTQWZhr8w/hofqHkWDI4Khz5btRgD8iMI6GpkzyRt1Btu9HZQWhwycoMG6wt3awSlLh7/1wzWFKsBdoGLXuCfAIMCKawEN6Mv4X6DY5xtILXc/08ch3S8PBLOwtQ9WjUJ+2uQzp3+AlTTLuQJN3wY2bMNpagAsIlkZnzfRWmqHcth1D8qcD/Tx3esjSE2orfXPxYaBPGEU9CkKcxSlwY1f9YvRG2iw8YUHJC4z2kVpRKrnM09AhZ2Zl7bMC4EyAQfmAEFU0SWNNF712Fl9y2ztXHbzfx8QYYF4gP0oWnZ8T7VBOJkZv/sZlStq21jTdy6uDUjivPl7dHeRiHVD1HsR35+k/gBbcie8iS0nQ0pUljVkRIS7slLzSTIxXnl/sP1Tg+bkqn2nFLJ3GelAEy7WxR+BJTEt2MdMRZQ6FUjIX4iz3WWQeKZbFWqP+RQcZTEMfcH9AJBO/BjJSR1Xnzwo7hqHJC0EHNiE2yn4npXJyd/oerzQwezAGq6k21zmjD9jmyjX2s4RGlhv9KmsBA56JSTrI0CqaqainYcnpsIvv2Ky4nlyNGQ27rVlnnUMaZ78xu/oiXYI7tKGPRNdbveJiKH9HMtcNrtL/pav1G9LSc5WBsYjevqi+SvADa+BFv+1QJHycsyUwHhnkk88lPaX4afbGjbTK1wNqXV/983u8a2YS0QuSv1G6+vHsk0T/gkoHDst5P9RwtuxlIQGGU3dpyuZynTITlb5teRTYaza6HlvE37Ysw9y9j9F9MHjexXw3lwYuGdnzwLFyxIV3DRiIIsxtcgZ5KG2GeOPJLEXGBNQ3uckXfP9q5nnwst0JrSm6wHVS9igKJG072q9mlhwaeoGdYDwTkgZQTqdKN2+mSktuQPMFeiojeVTz2Bs46aaY4xksOmxSTNtLoYnvb42VNDxOiI8akXvMN7w2WL+MYBTs9YZqblePRoqgy4C2TolEQv1olJrpFmrMqUVqJmWsSaOW2Yyys5V366DgiN1ZQCll/zms93OY3BivrHZgTquS/taXVYQ4gHlhBZRIsyimyr3znf1M0KvMjd0r4nc9fSxfGdoVe2zZSV2F9Bp5hD+j8e04D3wlAesor9xAAd38W7HzUIVpigBmkKUFsBRp7fgPkVwvc3Ipz3ylkvBgxSufHbL/5Sng3gUufc2AHj1iv5/JMdXNxy9sI0e7Ieq8nWLpHQRQ9Ok2yFp9rERKMtxGtd6E8T7c+8UnVOyt2WFfsQLjgF+fx+AfC3Xgo1SXP+YN8McW3PQDFcntHRD3oHz906VIqE4i1YhUG5/VJHsS7crXgpjOKAhnSa4DugDyg5cMBTvepmQYAEKtC3tMxD1e+lG5FgkCPOywjJaytyJabOnxCl7HVyR6avmHaerg6SJOAFXOnkWG4RdU+VesP09HH/TQLNKuIvdaU58Y5pDPJi1nUzE0bt7d9MK064e41ULIbl94gMW9AFZXMKkWuAtkcHeCSXt5xQjD5nin9bYDZ5/LgdyjEKc3yip4W6cjLM8Y8UYqO319nQ/FKO5h6mdfqH9jtZgoAzuZruSnS4xDb892UtmAiDrIN9KBFcjVAk4xcp0AtZz4CZLSdoDvHO0+c8D+I1oeiJNvg2mQmimGHr0WtcO0YfsAz034cVNzZR2XensPlBYmqsUzJ0KadJEdS6+uFPzPlaEOXHWZLSHZAvzfH4pNIlSLBiSWpqIX6ZlN2juIxys3NuVVV3BZNkjaSdvQe0YIGhX7QlB/siDUEia4KpYvzDIUgQau9aNzveNjrG9+LXPsPev+vza5L1vZILzqKnSBjuH5dS4oz6gqPdOknaSIEt5J2gAzlpwX6zAfQ/AF1syKMp/kQbsMxneQtRbTYChQ/K/e+X4m/FbscIhH2UTHg3psyzFmldUUeorktzyzMJUyfL9yFKI+YXOBbpnZ/1iywCfLAzvrX1eWI1fDX1HAzOf/V9ZKD/VuiVB4/PnO0+4018sC2ELwlG0nVCM8Sy7Y2LdXW38twHbsG0+YKvOioffC1H99QLQpiNi4FC9WVeNFD8iVzVcUs7z1HZy5Z432txLZ075eflY/KRfnmb3QwTCVDneh6ev6NC7KxMbjC7dpt+WEmQBanXVg22LU1jOncJYbBaQrJSeEjW6S6USGgl0XrMvDKo0ROpWLNOxA0iKHNM1bUAEQk6Pu12RppXviAse5ONNNFhfEhhvOD2w7krWKWqHg+WhcEWgE9JS0Oxd2GlsvONTq3PH9gUYekUpabIdlBwKRY638oGVQVcepLjHyAE/xHetHQcjDcHomksAh90jpUiZfA/2PPWaCvVMY3kNEIpzgB+/qjJGNUh28S7NQeJN3oUAnr+2tj77aHUHRlAyB0QO5djsUxTktk2FiTHL2tARgzvZoo9Ct/QYxr//GeRmuscs7VEZmF3M8QFngw6yX3BqZWpEHTrxXQ75n6D5xAvHzvj3O+PfzMX0J6TJJLdRdQJjO+Njh5PGgXMWlRMI90SnYbBR58SK+ETfP5/DkkVviS2ZPkGXeuWkvj+CQbzxe0qttZtXV30N4yWmwOvX7BnkORfqk8wD8FGl9BXd7yvdDsBbGj8oxy5oQpGysA0t38RCGlPBLar2WK//NAx/KscFFTtIX0dD7ANvpBWg0JOLP6km6cbxO82+0sqrdlY3gQ7lOzyzIHlNWLGNajjp0mbZ98F+468VEtmr4bcGk9qrc17oWDuXp6fdDtRGiuoLuOIhoTqd4FR6n4RErGne1GyH6Ypl/hSgAGHOPbo4P8jjLJjeZXqeoLYRqwyCU9VQrXzO/30UPY3YiQy59G8GgHNmAovT/vkqX+OfkY9dsso8bN3h/wdi5nShrRr89NIFybMqRKFiYOTUlpQBimUBQw3fxsdZxeMn6i2HlzZCYYkx1T/ENmC3wmuwnwW4toIlHJiIPP6lIh1Vm+QhfeTG+QY953KJHNx3An0x4Wd2Zlh9YEz2AxIDPRcE1HEKhNqxOu6UkaCrAHiPnhBpnRspSmUvPfTAiauH3ZuIWyW4wfvUfwDS9nYQ3/sHJGfHH5BajTbt2lApqhfQ/NlvfQkfp0mpUlxNZn8oZxQcDBb/M/sCgnSEcEtc56VZtD8fL+uTMdl0n5uA2Pq8VrUeAKk85R9gax+RItQ2znFHGKKcB+AfvnGQxxE2hRp8NJh3PBbnLWE5pVb35O5m3sXzFPN3n0CS+tGobJYkhCihMKykI90zxc1YQdIrowa3kFSiCT9ECTXEzsN14Lvnm5rhHHwISaa6QabkDqCOIUjdabS204wALH1ZAM/WPrkfUJUReqCSMBAcC+mfqji+Z2pDOLEpsRuW+p++txS2bi8ZEutijF1M4pIsOySYIrgYtXA5b5/O+TzQYBVlzc7zIoOev0lRiRy8fkYR2h91FIn3LYQ02DXX1wugiRfXdUTeqwlWeDSae72Owjgun8vz6b8fBpjsyN0/Pu2DOpcyOzplKAYMHDQ5o18wkfumj2jqg28+asDdZbGgK/obQirYM5RfJGn1nt1RNxfgrWIDY92JNu9Hh4pKnEQCEnfZj9RsQMXTBZYmzdoTYToNF4kj/VwyjJpoNxcO44kGO16GIqZQGCB56ttj26ogVY85OkiIH1NbvawZAgSRZYa6X7Qbs9oBNY4yBvot2rJcWVzx8pVRXjhfIVnW4xFkCqA110qMDxXRKBdCEmSFLl+D7AhzLWcIPj+u8ngACXi19CyMqFCpxmPHoKECOQKu+AEW/xDnFklN/D+Vj0kJS6V698C8JFqDJqv+BfDutWUvQkMgfiXJjqvqH4Gl0PFkVZdSy1VhOp/FNijB0F7Mak1K9JlMzxfT0QGn9aS+iGshlF1u8GnqwmtrK3aW4qqYIGZtm4Id85qmpzJXkDZT8Nx8k3DX38VQpq8EmZBose7KqF+OUencV0yaKcOjS+cPVZhhmxyvG2kFZdyi0RcjiWgMgVaK1EgYqDA94b5XAx7eh9c3z0HbID1zyl5VpS0xj8CY4hUvi66JqJ6vH1pe2dsl9suf9/aamPyuigTPba7UA+e+wMbxJsYQp9UyBY+50zrEvZRYHvQGVNOA8eyTjj1U06WJDrOFL+yrL2cliEsSVr/25Qa6zm6m2IN38T9K8+EEO26J5TXEmHGtFlXbK73k5f7FOhEpceiTlV21qAH32LW1wILMKToFfsNCBudrKpI54yG6AQNpxN3jhnPiwnBEaXXznYW/Ikt9Y1rq5FUwq5WSB69JYW7HHQCE4EiSZQsKz1MW3ZZaJtW8i2k+9Juhq79yjpxeOJgroNW+Bj80YxhT2Qm8a/gV1R5Ch9nEMaV1sQ1/J68ZA8uWFrdT3QYEDoa0aSsKbk4ns2hXW6gU7fUhA90AExFEyr/Tid7mQVrs5hTIcrIWlwXQzHF39VccfnW4O4ACW8i9ry3nPfGMuvZ69QnmJYqPxGwN8jXAUVZxHOTmk9IvB1MuaAwie2xDMOZa51/czWg5V4GG7S8ukjhFttllTQc2008b/lsd87qaDPhb5xEUi/zsD6W7zOEbMLoLbslbo2Gh1UxBfofMtY/lA9WKiETNcctn/mYs7OIFX8Ei3PvQ8PNf7MbJGo1L08tWtL5YXF+f2vhvRK96hUNx7RrZXvjTKAxz6+A3vPRkp55Fet9odrpiePZVCpRyLQG5H9wuIO4BPVWWGUMnDg0rmW6FKef/EfvmaNEgGoTk8mMVu7ipk4cyEnV4JWP6Io1Q7oVwD0VSpfX2Oy2bGfPDmhb2UpaRP0kVACGG3iIPEIm3dV68nEkpDU19vy3dWOfr5NHZmJ2j1GH6Z3HHhZAlfyasXknXr5/QXKcpHXD2On9VK6e/lGTZgia7IwW2RnTDjm8/T5uus+8h7f2/QY4mtk8fK/+GWd8A3Oay/Wwy5aeaalPApbn6LepDCNE/B/uVn8NY3qK2+Yonj0cKq7MnSsxjUfdSh5N3ZqX52oyyzF2OaMh0GgtUcowXF3DnF5O1BIWpUq8jcuSSWurEYV80x6DjmyV8x3ZUw936RVUdRPgSJV7LBJ08kcEBEZJ2TM6kEsja251zYsyqWhZTsraJ6ul83UnWBuS6MthOm5oLM6zNiGNqPC+mp29ln7cEUI5QD2HY5YJdOKgIkTH61y7Pe4awpvwL8RqjReUCJMd36DcRJkHCUCddcraKVN2mPJotc844PaKJ3liorL/PrGXQv4iCpz8/ENYUkHbHRdzSJGx99z6M+j4MbZVzg+PFg3Zu8gXaghW3RQyjvmKohCae5xrQ8w6SFvAPPVBPx82v56tZuZxbQi2nR3OJqioL9vuknWE5Eu+ZDYVYUYCxT8GzyPlCZun3t/UcUFI05qi33PoRMS/fFLg1c8TcYicb/KjYMmmg5IEHLMFHeLNllRU0czEZfa352ZEIvNjbPz83SMPvP6yBaceeBrq6frcXN6DXERtMnvY/VQC/G/htSzpHlZTiVHGZ9XPi2C66zF7UdV+1kdtXJC+f800vXP7W64SJ9DRpHcKBYffN06OZoxOVuwQub8Ct/navbsbBLx+HVoebvpPcrkp4eV0FHiLqn3WnB6s+Sb88zMF/81rppVaHyB2U8fYDVE+6IoizgBato3IzQiEwKRol4UMUMMDB2j7BTbAQaAT1nGUatj8+1b8nNV0rxN1/oiAfNCilTPD5Tn/rBN2OO80Xx9BkkcYSTiJpgizowMsR049CpCjcvJqboQVZzlDhKWSmtxAQ1f3DPvXm6fCchMXInk6UX88bv/CdF3dPKkDr5WuY71m1BFMiy5kJ4tDoBuKvGZOdRpsUqjhRGE7cI1r3D7acQo5LeaN3GxLiZ1JmdJA/9xEryUZJg7aTicWXoXFD444hA40UUzG8CsL6YNN35RP6+nPEIEyXeLw3Nk9DexTu1uRBrTcDZRX2VY1YNP1yi/xuZFNHtJf2raHzzlHyvZk4/fNydlpUZm2gWIzSEX6KRFi5QUDG9MuzacDnCASruveZXsyNpDfVnU6w4pl0q0+FbLXaYxeR/whb9gbql1fZIUPVK/iXGiptO5UO7H2AUfr3VB1AvmLrRsHEuj0d+yOgFxqndAnyxqQ40Qn6K+EReOxPHWlDn1fvuaaccHQkhPRnoIBFrkuK9s3L7/W08sFX4Ej9EJvSNtwAABTK0ErP2QaJnpkRkqjLhxmEqtnlzZuwie4KvCwgu/0lRfcsmJKLYYnDPAUZlP97ULCzrRIS17lHVIgldjP1NWxaX08YXQnqlPMEjNd0ayie48IPm6UU7LmRmZ+2I0fjh8juzkJObIWZp5Y9yAorg2oTRfOxoVrQ7o33ETdoDZO4CfJ2OV+KnvNfCc5h2m8eVgVYDXzpJGugcstjMIPaIX9tiVjgpj0BJ9Gl3+0DsbT7/axjmbq2/lNM7FSsp89OSF5lMLNfcfi0IBSOXvsgvBbLw9CvXZ4tqzds6tGloTXAThWpjX91dW3QBC3EgBTLrettXjlAUBA8xRkQkkV4CYytf4j6Up0EGqhZnaUGFp14Te8DwKxg9wahMFvVhpKMtkb3ZURqJOUAsuF+EAjlgHMjXQc1FsjlFjfmEi0hZ+Wad9jmrTGcKnYv9GBSimPTHVRpYF9mTkb8ixZFTnoSvVsG47/mHnEo15gqEbWCdEcRHatIuFzMM10EOSM6v2csQrnsuggTIvs23vIjYjdZugISAObYALMShOLt+K4/DKOHLewbENP4sfnt8BzJ/zlconlwlYZ4QMkBdInXNtnbHUfhjWQOsEedktFj16ckCvI2FujYLOfuF7QifWVG1/WDThsHGiE3OpAKA4U2kCgXupW0edql0wWWfpq1DH2GjuFAZ9WTHant+4GHWBkqG3M+M7obRuDj6vU0t4OJCoFTfcWgOX/kU6j6YlY/D6Xkrqu5fR/mJZaNrJvDPvi/BsGwUDdMH1NjslOMWsEl0STFSaNmGXFiaY/XwnCXkB3rx2l8NGox6NldMZQrTWzk/lChHHjsJmqPGTpiYdMvoD/MzMSmARgQGB8IM+acycRFpBi8wGPcj+w6Q44JpHzGvKDLV2zTNHJA1ZRn7AbtSfguIjennZUnULDhaALeyEdUF6gmS1K2Ovl3XpV4w87nn50fvUQl+TYKVuhOTiDpBZOuXsSLwvMXhqNpxyurNWGvF4KQfxNaokL06xouhf5bGI2pyaToorvYWr0YCgQgz2VmbC6eWoygGKUJAto9UXSFBFMwrSkBflLNJagIAlgXIpOAveGcEFdoC39+c6Flo+DNQ8smWf2RUXv8NiHTGY4a7LSe38sEwhcssomO7ukMKkncFQxF6EPiiIKQknxGEiVTxGt+URKts+ye4w5ftFabAtFQ77+RIud6cpTUyIsdh8KPqSjNJZgOEdQpHbR3VXnOeQZyW1SepzOkLmCzG8+CG9IlIO/6NHBGr8j/uUgb4h0svazkceG8HvzmWNmlgx/9FJhYgNMkLg/BWNnAxwdtBuX7lYG2zNjNJhcT1f4dT5kNoZm6vBUWSuelDMFmTQpIKvZ1bbnQJ3Zr4glPOvVBIRN5DS+JDQGqfPrKwKFr6NnK4mExbdNnnZSsvOvE8jVAU7N3Wq9+5S3qvXyVOCho1c+u/r4bNwLXnLBEXp1WMtwtYCRfvtGqAYIRh5b9Hh9HJtYORT7g+Iqkei5J88owXMY+6cBT3I+6b2KvHU0sZToVHKGhYB7WLPS12ZkxE5ipHOKN/YbxPkF2iPrusFFs+745FnM/8uWdykM2WBOK/dcWgI2+ggS42UF0fLhEeV2jO+eoJj14Xt2m8wBaECndevip3YFQ7cObnGdVknObzN1uNIn1BU/Dupt8nyJznTOqEi7/c7ot+fyFX1CV4l1gwRCyDGVLBZgQOkfgU8ZMqSYhCMR2uBkDwjO/Qu2Xm8Fm312spttOeuN9a60VDzVDfQbLeSsa/liFqaVz6SbVQPytp6pSiwQDCYwx9yFrLGEFfbEn+T3iD7YfFsaJ/olkNMPz2NVR3DzAk8+iHfgS5N+mM2M1bP0BaLdlnCFxEObSip8jCDtQeSsG/GSu8GbVOgvEDeSUsjPHgJiSHkB9xW4qqlIbH8/gto1P9gqU7qe+5WwHsSzquoQgScXyTJsk8cCkhJ+6wUxIF+bFHg65Xuv29GZaennG3bYbiCkemeKNxdv78Yi4McHGmPKTrOrEy8aoIU7tYOVt3hwn9RHc5M/rNYapu62BLcoMeN5UksBLkZDc14MFbRh3XbePb56s+7UCkPkzBuDKG1XoAAhnEcIR48Gep4lZjJBE5OHVUuhIwz3gCi14z8hyfjRsMvriTQVjoKNs0M5y5U63SdnEy89lMhQmkYRwVocBA/cqquWUExgOsX+4nLbaUSGzx4vPSbpR/b57PJuTO0HMCC6HXmhszZVaf90AAMyVNFDTXrEFjdYcSJlfWub342R93W0r1laFwDi/qktimjEh5MUXX7p3wHXzO7H3+/G2Jd+UEFWNpKOEcRSQQYediYNRBcTAGSnx3RFo6H/8WhkBusI3vT3g1+RG/f4PcCIGqIeSTgL5Mr/ewXEwYdbK+IHf4JDtUMsBTc/ojM1JjSKQ445iDFChz4J4PBEwPfy4Z6cuOsBEgBQ1clJO99UxZD0bAyQ4wA491YakV92WVUSNQHOIf7hUq/t8s0rNKfbAPAt/nal5SD/diRWMuU2FoPPTQBajU/9BaKxogtURcVM3w7x2G6fZq2dy93VAo1XsT4Voa22MFlpYJMzGJR0MgP9GbGEptudRcEld2sApCHlVaFV6Oop4dLHpsHWHEp88ca59VsG2PCfeABqAtx8Z4Qghm51YzW6eSkZhZ43o1I/NQYFGInsJ9W3hYgzHJAtIW9puYEwZJgLeYAvgeMC3Q1lUDR04bbmQsvvs8w3w7wVr7WoHxH6pKAaxSU+zcT4Dd6E7t+CdaLfwXzeWCJGSsEY++1nB3/25bF2yMj3zilWrIBzT9QdSavGdwG0qw7K+KBambVqWXOV1rgPeG0MozJcrRAkhtGFkPifBTHwIVJHZU6fDJMiUz4v6OrNnCNj632orjBGJz19PGl2DKHuZjYo0JswHfSdmhW4t5YGwX3ChPojQPDE4ZeoEiEG5SBUNnjz43uhht+PegcjTTS9v1HH69V5sNB9Y2o/asYnRBkOInGzcNy+ziipnM8xf6AjuN9t9w7sTOlhjNbdfWlIzAQWtfYHynCWYMGA82iX3RkDa/sjWOqe7YWTLRo2JZyyHQ4DZczPFvMrZlMXF/CGMiGHbdQXUVHtTUxnrH78/T3Pie+sO6mTuzcova5UDgTWtykNNsLVB5wMLlrro1N4T5i835o9lNxerUlwaMwJFeipThvt8ERfQiBUpcPW1DVcNO7iwzz8Lx5t/pff4ZA0v1xWF3Mj5+B3NKzd+wSNxmCIyHvyU/KZMkFOtLjPo91agAmSYf6jwf+bUF2K1wDO8Kjps9bXPb6MjsheJ3cyt/3prfY0B1/eu/Sk1QF1GlIb1+7QqL8tD0dnfd0dc8njGZXzpx4hC5Zl+psd8C3tY11k6uqpQDqnaHuOR7Udb04fnGGOvIX8Q2VfVd7CHyn0u99nY8hvwMwj8+66BzWNYHC+uLygrJ+oPxak0jehSSyajlbcPxPztdfJvBfgDnadcI5CO3raotqgUi/JctCi8NZlxQja0Fm2Xr14v76HIa5wjWzNYJbC2/MT7YGzGH/sC0GLYvZ6OFzF2WT3PCCDAHeLM/fQxeLvneHHC04Idf+Ye/pz8wHER+cCx4rVF5VsI+5nyorpWJSVUjqYdhEpuYtb3sGjv+NYwGV1x/HIIcmgexlQ1A7p6cm5WNKJvLNkorhAPVMP2Ar6+pxzZIfZpocluibg7vm19+vnaB3LG/R+GRd6E9UquNis+v/2fVGrEEIUc66Fo2GFvTmaIvp7A68T9w/43VOpZtSBImLvsN7oPuIt4fWZf+bEs4os9unYNTO8MqqREES761NChHQMOrxAIcw2knlAuqVbLgaPsqoq4k8MuteSJwEthygaCWYUT5pGxpRDNI6NHa6xFglPn8//K06yYk2H4uTGrXxGo9C8+AQvxK3LIqqY44oPpZ87TmjCLFiAWEyD4varC7DhNykKnjG7Rk3+IfLnu0n0gX6Iwm6TIdvaeZ0wuBci1aDHsqvdbMYSKyx1jH8bXa6zKn7NKiLi67VVnh8IobtTbqz22a/mVbonT1T8Gis1UDQv3tFff7QDWKwLXszUJ21QC7/WFkKtUYIp+XrAEUk7HKDtJXRUplsDPX2HMhcKbfZY3pKe/wyQ0uuRoNwNmVbiDYkCg2mSQn7gD+1PydvXluFMtvojf2qPBsYJnf3fL3j8+euAQpKpEGkFQF1JDueiPTiLaKTXzzfJvWlSdfXiwiq8TmeVkFWyg5AgnaZ/b/59BAvcjtYaUcqp99suE8nG2mNo+aG4tVWN9+0GJCOFkM5ags3tDd9vgFVnsbThb4jRQdGBkpKUyvRPoHuvq9gWxUmAWpG7GLXwy+ee3S7ffJWy62Y6CXIifpLTfxpM+7r210VH4fByEBUGtss7fvRZ0tGkGbvPXZ1VuFYN2sURrW0XI1h6VgAb6DpZyuWRerRZLmjyfYhGnhqSlutRb2b7/wkuSYab1v4lj/lk/cCqMc0fVGXaF41ECNw4QXflCxYAL5c1oIl8B0cSBkBlnxHO/Mowue6VyYk1WaNzUQ2InQ5oepAu4aQt7GCF2tOLuj/jE6ngW45DJ8oNN8QVnYsjqU4gbwBO2pQFL11WNXriCfzXLvtY4rOVqffRXUJfXvE6By+MeBB/6Px9jlY8ri2RFXCiN7LQhrff79LDrtQmCYaqrXlgoiiMyLEQv16AumnBcFnw3OOFmpHOVa/eGayitpMY+sb0MuY0afI4hgepF2ooqFRFHcArjdaqw+Uu2ekAEovklW5cxYhcWoruBdWjaYRFMG8aaLxyvqq2c/GjLVABKLCuqLI3NqKiqUGc8WfUyeoY0gxSpCsoE+MhLX6I4t7ka6woU66/j2WkH8nYtQAZ+oaRnD2SezZI8xTJqVeX6ZCw5TkWHjb2kPzOSsYwB/snMWcP/emTZX8rMe7oq7Pc8bEDFItNynN6o6kxNc6UP/mrlPsqwrwknx6BopUyS3miAebwm8IEN0q8gCbe0J6IfHZX8p9rWpvHyE4+n2sB3/Xq7+Lk/dLlPLTHrFoVyDxvSn42eV2RRG7ORPGqo6oqgL4FXjzi8Ss1PriATIUHWT181UeNa+fP5T1Z4EeTQeqxOREnsCzBOxJONo9oT45E2R8c1qMx1OG3EgY9EiJ9mmn8QQubPs6w+zaNK4wrJBDACY5fbyHVtX0HkHmfVVZkdVBKtDalWJVeVL4GEuUajsdcn07JVxY3GMkjKZkoecbrxTVm3D88crnjHmEAMALraLHMVF/UKLqSNJyVj2/FG6PPjnD0+3rv+KdSD4GVGeCmC5lHnAgGVKAp35et4gXIKT4yO9LUOgJ5SzRY75IL4Yy9qTQmsQp2PsxkKk6m4hkj/JbQlXWMR0WLRVr43otOVzqWCEHEgVlHVFy9sQ+6ce5PzB1m3UDldAS1/Un3G3TEbYMsU/cxX+b4M+DCucxwdM4a3MqNO/UNd/X56OKrPID4dDX70vEmbRKUL1fbpSr8jSX9UfkaIHBlK8LUEJzMtKFKM9/VK8LPLppvbZhlu2/m8LnatA3oVedG6vpUazp04826diEu7umYK4uRGqUN7kYow+gMHMU7+1rFLcU1SxEqjO5dF+lhGp0A8YXR6u5hWjNn5eVtuwrBVQLq8RQJGJswWjC1LWK0Ska+Z19evHvnRPuVoc8+cFyF1ZZOHqmSkdJl3o+638pgxQ8YxlGoYha5kqcCDLJXOAbenpJXzmBHhjQwmEpIP3v6fenCJt3nMOL4bmNMOYVxkHxwaIuX8YZ7TWmYxwS0SSTrNhBYrPSGnWhRYnzmKNFtDaRg6feXV8JIXmW7WOtPDK/Z8yryNbTo/lLKD1pp4FvjpZe7SOQJwrYBA808FiKt2YzVnDvLREBf7F6gCps8B06kQ=="}
</script>
  <!-- Main JavaScript -->
  <script>
    /*<![CDATA[*/
    function hexToRgb(hex) {
      hex = hex.replace(/^#/, "");
      if (hex.length === 3)
        hex = hex[0] + hex[0] + hex[1] + hex[1] + hex[2] + hex[2];
      if (hex.length !== 6) return null;
      return {
        r: parseInt(hex.substring(0, 2), 16),
        g: parseInt(hex.substring(2, 4), 16),
        b: parseInt(hex.substring(4, 6), 16),
      };
    }
    function rgbToHex(r, g, b) {
      const toHex = (c) => ("0" + c.toString(16)).slice(-2);
      return "#" + toHex(r) + toHex(g) + toHex(b);
    }
    function generateHCColor(hex) {
      const rgb = hexToRgb(hex);
      if (!rgb) return "#FFFF00";
      let channels = [
        { key: "r", value: rgb.r },
        { key: "g", value: rgb.g },
        { key: "b", value: rgb.b },
      ].sort((a, b) => b.value - a.value);
      rgb[channels[0].key] = Math.min(
        255,
        Math.floor(rgb[channels[0].key] * 5)
      );
      rgb[channels[1].key] = Math.min(
        255,
        Math.floor(rgb[channels[1].key] * 2)
      );
      rgb[channels[2].key] = Math.min(
        255,
        Math.floor(rgb[channels[2].key] / 5)
      );
      return rgbToHex(rgb.r, rgb.g, rgb.b);
    }
    function getDefaultColor(id) {
      const palette = [
        "#b3cde0",
        "#ccebc5",
        "#fbb4ae",
        "#ebd9f4",
        "#f4e8d9",
        "#D0D9E2",
        "#C3C2D5",
      ];
      let hash = 0;
      for (let i = 0; i < id.length; i++) {
        hash = id.charCodeAt(i) + ((hash << 5) - hash);
      }
      const index = Math.abs(hash) % palette.length;
      return palette[index];
    }
    function getPositionColor(id) {
      const pos = config.positions.find((p) => p.id === id);
      let normal = pos && pos.color ? pos.color : getDefaultColor(id);
      let highContrast =
        pos && pos.highContrastColor
          ? pos.highContrastColor
          : generateHCColor(normal);
      return { normal, highContrast };
    }
    function renderContent(content) {
      if (typeof content === "string") {
        const p = document.createElement("p");
        p.innerHTML = content.replace(/\n/g, "<br>");
        return p;
      }
      if (Array.isArray(content)) {
        const fragment = document.createDocumentFragment();
        content.forEach((item) => {
          fragment.appendChild(renderContent(item));
        });
        return fragment;
      }
      if (typeof content === "object" && content !== null) {
        if (content.type === "paragraph") {
          const p = document.createElement("p");
          p.innerHTML = content.text
            ? content.text.replace(/\n/g, "<br>")
            : "";
          return p;
        } else if (content.type === "list") {
          const ul = document.createElement("ul");
          ul.className = "list-group list-group-flush";
          if (Array.isArray(content.items)) {
            content.items.forEach((item) => {
              const li = document.createElement("li");
              li.className = "list-group-item";
              li.appendChild(renderContent(item));
              ul.appendChild(li);
            });
          }
          return ul;
        } else {
          const p = document.createElement("p");
          p.innerHTML = content.text
            ? content.text.replace(/\n/g, "<br>")
            : "";
          return p;
        }
      }
      return document.createElement("div");
    }
    async function showToast(message, type = "success", delay = 0, timeout = 2000) {
      const toastEl = document.getElementById("generic-toast");
      const toastText = document.getElementById("generic-toast-text");
      toastEl.className = `toast align-items-center text-bg-${type} border-0`;
      toastText.textContent = message;

      // Add click handler for close button
      const closeBtn = toastEl.querySelector('.btn-close');
      const closeHandler = () => {
        toastEl.style.display = "none";
        closeBtn.removeEventListener('click', closeHandler);
      };
      closeBtn.addEventListener('click', closeHandler);

      setTimeout(() => {
        toastEl.style.display = "block";
        if (timeout > 0) {
          setTimeout(() => {
            toastEl.style.display = "none";
          }, timeout);
        }
      }, delay);
    }
    function showToastSkillFilter(skillName) {
      const message = skillName
        ? defaultConfig.translations[currentLanguage].skill_filter_toast.replace("{skill}", skillName)
        : defaultConfig.translations[currentLanguage].skill_filter_clear_toast;
      showToast(message);
    }
    function updateTranslations() {
      const trans = defaultConfig.translations;
      document.querySelectorAll("[data-i18n]").forEach((el) => {
        const key = el.getAttribute("data-i18n");
        if (trans[currentLanguage] && trans[currentLanguage][key]) {
          if (el.hasAttribute("placeholder")) {
            el.setAttribute("placeholder", trans[currentLanguage][key]); // Update placeholders
          } else {
            el.textContent = trans[currentLanguage][key]; // Update text content
          }
        }
      });


      document.querySelectorAll("[data-i18n]").forEach((el) => {
        const key = el.getAttribute("data-i18n");
        if (trans[currentLanguage] && trans[currentLanguage][key]) {
          if (el.hasAttribute("placeholder")) {
            el.setAttribute("placeholder", trans[currentLanguage][key]);
          } else {
            el.textContent = trans[currentLanguage][key];
          }
        }
      });

      document.getElementById("lang-toggle").textContent = trans[currentLanguage].lang_toggle
      const emailLink = document.getElementById("email-link");
      if (emailLink) {
        emailLink.title =
          currentLanguage === "en"
            ? config.personal_info.email_tooltip_en
            : config.personal_info.email_tooltip_de;
      }
      const phoneLink = document.getElementById("phone-link");
      if (phoneLink) {
        phoneLink.title =
          currentLanguage === "en"
            ? config.personal_info.phone_tooltip_en
            : config.personal_info.phone_tooltip_de;
      }
      document.querySelectorAll(".position-card").forEach((card) => {
        const pid = card.getAttribute("data-id");
        const pos = config.positions.find((p) => p.id === pid);
        if (pos && pos.translations && pos.translations[currentLanguage]) {
          const t = pos.translations[currentLanguage];
          card.querySelector("h5").textContent = t.title || pos.title;
          card.querySelector("h6").textContent = t.company || pos.company;
          let descContainer = card.querySelector(".position-description");
          if (!descContainer) {
            descContainer = document.createElement("div");
            descContainer.classList.add("position-description");
            card.appendChild(descContainer);
          }
          descContainer.innerHTML = "";
          if (t.description || pos.description) {
            descContainer.appendChild(
              renderContent(t.description || pos.description)
            );
          }
        }
      });
      d3.selectAll(".skill-bubble").each(function (d) {
        if (
          d.translations &&
          d.translations[currentLanguage] &&
          d.translations[currentLanguage].title
        ) {
          d3.select(this).text(d.translations[currentLanguage].title);
        } else {
          d3.select(this).text(d.id);
        }
      });
      document.querySelectorAll(".accomplishment-item").forEach((item) => {
        const accData = item.dataset.acc
          ? JSON.parse(item.dataset.acc)
          : null;
        if (
          accData &&
          accData.translations &&
          accData.translations[currentLanguage] &&
          accData.translations[currentLanguage].label
        ) {
          const span = item.querySelector("span");
          if (span)
            span.textContent = accData.translations[currentLanguage].label;
        }
      });
      document
        .querySelectorAll(".position-badges span.badge")
        .forEach((badge) => {
          let skillId =
            badge.getAttribute("data-skill") || badge.textContent.trim();
          const skillObj = config.skills.find((s) => s.id === skillId);
          if (
            skillObj &&
            skillObj.translations &&
            skillObj.translations[currentLanguage] &&
            skillObj.translations[currentLanguage].title
          ) {
            badge.textContent = skillObj.translations[currentLanguage].title;
          } else {
            badge.textContent = skillId;
          }
        });

      // Update preferences visualization if it exists
      if (config && config.preferences) {
        const container = d3.select("#preferences-chart-container");
        const isBarChart = d3.select("#preferences-view-toggle").property("checked");
        renderPreferences(config.preferences, isBarChart, container.select(".preferences-viz-container"));
      }
    }
    function toggleLanguage() {
      currentLanguage = currentLanguage === "en" ? "de" : "en";
      updateTranslations();
      initSkillTree();
      initTimeline();
    }
    function updateColors() {
      document.querySelectorAll(".position-card").forEach((card) => {
        const { normal, highContrast } = getPositionColor(
          card.getAttribute("data-id")
        );
        card.style.setProperty(
          "border-left-color",
          document.body.classList.contains("high-contrast")
            ? highContrast
            : normal,
          "important"
        );
      });
      applyTimelineColors();
      d3.selectAll(".preference-bar")
        .attr("fill", function (d) {
          const colorScale = document.body.classList.contains("high-contrast")
            ? d3.scaleSequential(d3.interpolateYlOrRd)
            : d3.scaleSequential(d3.interpolateBlues);
          colorScale.domain([0, 10]);
          return colorScale(d.level);
        });
    }
    function toggleContrast() {
      document.body.classList.toggle("high-contrast");
      updateColors();
    }
    function populatePersonalInfo(info) {
      const nameEl = document.querySelector('[data-i18n="name"]');
      if (nameEl) {
        nameEl.textContent = info.name;
        nameEl.setAttribute("data-copy", info.name);
      }
      const titleEl = document.querySelector('[data-i18n="title"]');
      if (titleEl) titleEl.textContent = info.title;
      const birthEl = document.querySelector('[data-i18n="birthplace"]');
      if (birthEl) birthEl.textContent = info.birthplace;
      const dobEl = document.querySelector('[data-i18n="dob"]');
      if (dobEl) dobEl.textContent = info.dob;
      const phoneEl = document.querySelector('[data-i18n="phone"]');
      if (phoneEl) {
        phoneEl.textContent = info.phone;
        phoneEl.setAttribute("data-copy", info.phone);
      }
      const langEl = document.querySelector('[data-i18n="languages"]');
      if (langEl) langEl.textContent = info.languages;
      const emailElem = document.querySelector('[data-i18n="email"]');
      if (emailElem) {
        emailElem.textContent = info.email;
        emailElem.setAttribute("data-copy", info.email);
      }
      const emailLink = document.getElementById("email-link");
      if (emailLink) emailLink.href = `mailto:"${info.name}"<${info.email}>`;
      const phoneLink = document.getElementById("phone-link");
      if (phoneLink)
        phoneLink.href = "tel:" + info.phone.replace(/[^0-9+]/g, "");

      const profileImageSrc = getProfileImage(info.email, info.image);
      const imgElement = document.getElementById("portrait-image");
      if (imgElement) imgElement.src = profileImageSrc;
    }
    function populatePositions(positions) {
      const container = document.getElementById("position-list");
      container.innerHTML = "";
      positions.forEach((pos) => {
        const card = document.createElement("div");
        card.classList.add("card", "position-card", "p-3");
        card.setAttribute("data-id", pos.id);
        card.setAttribute("data-start", pos.start);
        card.setAttribute("data-end", pos.end);
        card.setAttribute("data-company", pos.company);
        card.setAttribute("data-skills", (pos.skills || []).join(","));

        // Add category badge
        const categoryLabel = (pos.category || 'work').charAt(0).toUpperCase() + (pos.category || 'work').slice(1);
        const categoryBadge = `<span class="category-badge ${pos.category}">${categoryLabel}</span>`;

        const { normal, highContrast } = getPositionColor(pos.id);
        card.style.setProperty(
          "border-left-color",
          document.body.classList.contains("high-contrast")
            ? highContrast
            : normal,
          "important"
        );
        const t =
          pos.translations && pos.translations[currentLanguage]
            ? pos.translations[currentLanguage]
            : {};
        const title = t.title || pos.title || pos.id;
        card.innerHTML = `${categoryBadge}
          <h5 class="card-title mb-1">${title}</h5>
          <h6 class="card-subtitle mb-1 text-muted company">${pos.company}</h6>
          <h7 class="card-subtitle mb-2 text-muted date">
            <span class="start-date">${pos.start}</span> – <span class="end-date">${pos.end}</span>
          </h7>`;
        const descContainer = document.createElement("div");
        descContainer.classList.add("position-description", "card-text");
        if (t.description || pos.description) {
          descContainer.appendChild(
            renderContent(t.description || pos.description)
          );
        }
        card.appendChild(descContainer);
        if (pos.skills && pos.skills.length > 0) {
          const badgeContainer = document.createElement("div");
          badgeContainer.classList.add("position-badges");
          pos.skills.forEach((skill) => {
            const badge = document.createElement("span");
            badge.classList.add("badge", "bg-secondary", "ms-1");
            badge.setAttribute("data-skill", skill);
            badge.textContent = skill;
            badge.style.cursor = "pointer";
            badge.addEventListener("click", function (event) {
              event.stopPropagation();
              if (selectedSkill === skill) {
                selectedSkill = null;
                d3.selectAll(".skill-bubble").classed("selected", false);
                document
                  .querySelectorAll(".position-card")
                  .forEach((card) => {
                    card.classList.remove("dimmed", "highlighted");
                  });
                showToastSkillFilter("");
              } else {
                selectedSkill = skill;
                d3.selectAll(".skill-bubble").classed("selected", false);
                d3.selectAll(".skill-bubble")
                  .filter(function (d) {
                    return d.id === skill;
                  })
                  .classed("selected", true);
                document
                  .querySelectorAll(".position-card")
                  .forEach((card) => {
                    const skills = card
                      .getAttribute("data-skills")
                      .split(",")
                      .map((s) => s.trim());
                    if (skills.includes(skill)) {
                      card.classList.add("highlighted");
                      card.classList.remove("dimmed");
                    } else {
                      card.classList.add("dimmed");
                    }
                  });
                let skillName = skill;
                d3.selectAll(".skill-bubble").each(function (d) {
                  if (
                    d.id === skill &&
                    d.translations &&
                    d.translations[currentLanguage] &&
                    d.translations[currentLanguage].title
                  ) {
                    skillName = d.translations[currentLanguage].title;
                  }
                });
                showToastSkillFilter(skillName);
              }
            });
            badgeContainer.appendChild(badge);
          });
          card.style.position = "relative";
          card.appendChild(badgeContainer);
        }
        container.appendChild(card);
      });
    }

    function populateSkills(skills) {
      window.skillData = skills;
      initSkillTree();
    }

    function addSkillAnimationSwitch() {
      // Only add the switch in normal mode (not in high-contrast)
      if (document.body.classList.contains("high-contrast")) return;

      let parentDiv = document.getElementById("skill-tree-chart-container").parentElement;

      // Create visualization container if it doesn't exist
      let vizContainer = document.getElementById("skill-tree-viz-container");
      if (!vizContainer) {
      vizContainer = document.createElement("div");
      vizContainer.id = "skill-tree-viz-container";
      parentDiv.insertBefore(vizContainer, parentDiv.firstChild);
      }

      // Add the animation switch
      let switchContainer = document.getElementById("skill-animation-switch");
      if (!switchContainer) {
      switchContainer = document.createElement("div");
      switchContainer.id = "skill-animation-switch";
      switchContainer.className = "form-check mt-2 card p-1";
      switchContainer.innerHTML = `
        <input class="form-check-input" type="checkbox" id="disable-animation-switch">
        <label class="form-check-label" for="disable-animation-switch" data-i18n="disable_skill_animation">
        Static Layout
        </label>
      `;
      parentDiv.appendChild(switchContainer);

      document.getElementById("disable-animation-switch").addEventListener("change", function () {
        disableSkillAnimation = this.checked;
        initSkillTree();
      });
      }

      // Ensure legend stays at the bottom
      let legendEl = document.getElementById("skill-tree-legend");
      if (legendEl) {
      parentDiv.appendChild(legendEl);
      }
    }

    function initSkillTree() {
      const container = d3.select("#skill-tree-chart-container");
      const containerNode = container.node();
      const width = containerNode.clientWidth;
      let height = containerNode.clientHeight;

      container.selectAll(".skill-bubble").remove();
      addSkillAnimationSwitch();
      const nodes = window.skillData.map(d => Object.assign({}, d));

      const skillBubbles = container
        .selectAll(".skill-bubble")
        .data(nodes)
        .enter()
        .append("button")
        .attr("type", "button")
        .attr("class", "skill-bubble btn btn-light")
        .style("font-size", d => (10 + d.level * 2) + "px")
        .text(d => (d.translations && d.translations[currentLanguage] && d.translations[currentLanguage].title) ? d.translations[currentLanguage].title : d.id);

      // If static layout or print mode, adjust container height based on content
      if (disableSkillAnimation || window.matchMedia('print').matches) {
        skillBubbles.style("position", "static");

        // Add a small delay to ensure all bubbles are rendered
        setTimeout(() => {
          const bubbles = container.selectAll(".skill-bubble").nodes();
          if (bubbles.length > 0) {
            let maxBottom = 0;
            bubbles.forEach(bubble => {
              const rect = bubble.getBoundingClientRect();
              maxBottom = Math.max(maxBottom, rect.bottom - containerNode.getBoundingClientRect().top);
            });
            // Add some padding
            containerNode.style.height = (maxBottom + 20) + 'px';
          }
        }, 0);
      } else {
        // For animated layout, use simulation
        const simulation = d3.forceSimulation(nodes)
          .force("charge", d3.forceManyBody().strength(-60))
          .force("x", d3.forceX(width / 2).strength(0.16))
          .force("y", d3.forceY(height / 2).strength(0.16))
          .force("collision", d3.forceCollide().radius(d => 20 + d.level * 4).iterations(2))
          .on("tick", () => {
            skillBubbles
              .style("left", d => Math.max(0, Math.min(width - 130, d.x)) + "px")
              .style("top", d => Math.max(0, Math.min(height - 50, d.y)) + "px");

            // Adjust container height if any bubble exceeds current height
            let maxY = 0;
            nodes.forEach(node => {
              maxY = Math.max(maxY, node.y + 50); // 50px for bubble height
            });
            if (maxY > height) {
              containerNode.style.height = (maxY + 20) + 'px';
              height = maxY + 20;
            }
          });

        simulation.alphaTarget(0.2).restart();
      }

      // Attach hover events on desktop only
      if (!document.body.classList.contains("mobile")) {
        skillBubbles.on("mouseenter", (evt, d) => {
          d3.select(evt.currentTarget).classed("hovered", true);
          highlightPositions(d.positions);
          highlightSkillBubbles([d.id]);
        });
        skillBubbles.on("mouseleave", (evt, d) => {
          d3.select(evt.currentTarget).classed("hovered", false);
          if (!selectedSkill) {
            unhighlightAllPositions();
            unhighlightAllSkills();
          }
        });
      }
      // Always attach click events
      skillBubbles.on("click", function (event, d) {
        event.stopPropagation();
        if (selectedSkill === d.id) {
          selectedSkill = null;
          d3.selectAll(".skill-bubble").classed("selected", false);
          document.querySelectorAll(".position-card").forEach(card => {
            card.classList.remove("dimmed", "highlighted");
          });
          showToastSkillFilter("");
        } else {
          selectedSkill = d.id;
          d3.selectAll(".skill-bubble").classed("selected", false);
          d3.select(this).classed("selected", true);
          document.querySelectorAll(".position-card").forEach(card => {
            const skills = card.getAttribute("data-skills").split(",").map(s => s.trim());
            if (skills.includes(d.id)) {
              card.classList.add("highlighted");
              card.classList.remove("dimmed");
            } else {
              card.classList.add("dimmed");
            }
          });
          let skillName = (d.translations && d.translations[currentLanguage] && d.translations[currentLanguage].title) ? d.translations[currentLanguage].title : d.id;
          showToastSkillFilter(skillName);
        }
      });
    }

    function toDate(dateStr) {
      const parseDate = d3.timeParse("%Y-%m");
      const parseYear = d3.timeParse("%Y");
      return dateStr.includes("-") ? parseDate(dateStr) : parseYear(dateStr);
    }

    function initTimeline() {
      const positions = Array.from(document.querySelectorAll(".position-card"))
        .reverse()
        .map((card) => {
          const pid = card.getAttribute("data-id");
          const pos = config.positions.find(p => p.id === pid);
          const startStr = card.getAttribute("data-start");
          const endStr = card.getAttribute("data-end");
          const skills = (card.getAttribute("data-skills") || "")
            .split(",")
            .map((s) => s.trim())
            .filter(Boolean);
          return {
            id: pid,
            start: startStr,
            end: endStr,
            skills,
            startDate: toDate(startStr),
            endDate: toDate(endStr),
            category: pos.category || 'work',
            label: pos.translations?.[currentLanguage]?.title || pos.title || pid
          };
        });

      if (!positions.length) return;

      const categories = ['education', 'work', 'volunteering'];
      const categoryColors = {
        education: '#4a90e2',
        work: '#50c878',
        volunteering: '#ffa500'
      };

      const minDate = d3.min(positions, (d) => d.startDate);
      const maxDate = d3.max(positions, (d) => d.endDate);
      const extendedMinDate = d3.timeMonth.offset(minDate, -12);
      const extendedMaxDate = d3.timeMonth.offset(maxDate, 12);
      const svgEl = document.getElementById("timeline-svg");
      const width = svgEl.clientWidth;
      const height = svgEl.clientHeight;
      const svg = d3.select(svgEl);
      svg.selectAll("*").remove();

      const margin = { top: 50, right: 20, bottom: 30, left: 100 };
      const timelineHeight = (height - margin.top - margin.bottom) / categories.length;

      const xScale = d3.scaleTime()
        .domain([extendedMinDate, extendedMaxDate])
        .range([margin.left, width - margin.right]);

      // Add category labels
      svg.selectAll(".timeline-category")
        .data(categories)
        .enter()
        .append("text")
        .attr("class", "timeline-category")
        .attr("x", margin.left - 10)
        .attr("y", (d, i) => margin.top + (i * timelineHeight) + (timelineHeight / 2))
        .attr("text-anchor", "end")
        .attr("dominant-baseline", "middle")
        .text(d => d.charAt(0).toUpperCase() + d.slice(1));

      // Add time axis with grid lines every 5 years
      const xAxis = d3.axisBottom(xScale)
        .ticks(d3.timeYear.every(5))
        .tickSize(-height + margin.top + margin.bottom);

      const xAxisGroup = svg.append("g")
        .attr("class", "x axis")
        .attr("transform", `translate(0,${height - margin.bottom})`);

      xAxisGroup.call(xAxis)
        .selectAll(".tick line")
        .attr("stroke", "#ddd")
        .attr("stroke-dasharray", "2,2");

      xAxisGroup.selectAll(".domain")
        .attr("stroke", "#999");

      // Create timeline items for each category
      categories.forEach((category, categoryIndex) => {
        const categoryPositions = positions.filter(p => p.category === category);

        const timelineItems = svg.selectAll(`.timeline-rect-${category}`)
          .data(categoryPositions)
          .enter()
          .append("g")
          .attr("class", `timeline-rect-group ${category}`);

        timelineItems.append("rect")
          .attr("class", "timeline-rect")
          .attr("data-id", d => d.id)
          .attr("x", d => xScale(d.startDate))
          .attr("y", margin.top + (categoryIndex * timelineHeight) + 5)
          .attr("width", d => Math.max(5, xScale(d.endDate) - xScale(d.startDate)))
          .attr("height", timelineHeight - 10)
          .attr("fill", d => {
            const { normal, highContrast } = getPositionColor(d.id);
            return document.body.classList.contains("high-contrast")
              ? highContrast
              : normal;
          });

        timelineItems.append("text")
          .attr("class", "timeline-label")
          .attr("x", d => xScale(d.startDate) + 5)
          .attr("y", margin.top + (categoryIndex * timelineHeight) + (timelineHeight / 2))
          .attr("dominant-baseline", "middle")
          .each(function(d) {
            const text = d3.select(this);
            const rectWidth = xScale(d.endDate) - xScale(d.startDate) - 10;
            const label = d.label;

            // Function to truncate text
            function truncateText(text, width) {
              text.text(label);
              let textLength = text.node().getComputedTextLength();
              let truncated = label;
              while (textLength > width && truncated.length > 0) {
                truncated = truncated.slice(0, -1);
                text.text(truncated + '…');
                textLength = text.node().getComputedTextLength();
              }
            }

            truncateText(text, rectWidth);
          });
      });

      // Create custom tooltip
      let tooltip = d3.select("body").select("#timeline-tooltip");
      if (tooltip.empty()) {
        tooltip = d3.select("body")
          .append("div")
          .attr("id", "timeline-tooltip")
          .attr("class", "tooltip-custom");
      }

      // Add hover and click handlers
      svg.selectAll(".timeline-rect")
        .on("mouseenter", function(event, d) {
          const card = document.querySelector(`.position-card[data-id='${d.id}']`);
          if (card) {
            card.classList.add("highlighted");
            highlightSkillBubbles(d.skills);
            highlightAccomplishments({ positions: [d.id], skills: d.skills });
          }
          const posConfig = config.positions.find((p) => p.id === d.id);
          const posTitle = posConfig?.translations?.[currentLanguage]?.title || posConfig?.title || d.id;
          tooltip
            .html(`${config.translations[currentLanguage].timeline_position}: ${posTitle}<br>` +
                  `${config.translations[currentLanguage].timeline_from}: ${d.start}<br>` +
                  `${config.translations[currentLanguage].timeline_to}: ${d.end}`)
            .style("opacity", 1)
            .style("left", event.pageX + 10 + "px")
            .style("top", event.pageY + 10 + "px");
        })
        .on("mousemove", function(event) {
          tooltip
            .style("left", event.pageX + 10 + "px")
            .style("top", event.pageY + 10 + "px");
        })
        .on("mouseleave", function(event, d) {
          const card = document.querySelector(`.position-card[data-id='${d.id}']`);
          if (card) {
            card.classList.remove("highlighted");
            unhighlightAllSkills();
            unhighlightAccomplishments();
          }
          tooltip.style("opacity", 0);
        })
        .on("click", function(event, d) {
          const card = document.querySelector(`.position-card[data-id='${d.id}']`);
          if (card) card.scrollIntoView({ behavior: "smooth", block: "center" });
        });

      applyTimelineColors();
      positionRects(xScale);
    }

    function applyTimelineColors() {
      document.querySelectorAll(".timeline-rect").forEach((rect) => {
        const d = rect.__data__;
        const { normal, highContrast } = getPositionColor(d.id);
        rect.style.fill = document.body.classList.contains("high-contrast")
          ? highContrast
          : normal;
      });
    }
    function positionRects(xScale) {
      const rects = d3.selectAll(".timeline-rect");
      const margin = { top: 50, right: 20, bottom: 30, left: 100 };
      const timelineHeight = (document.getElementById("timeline-svg").clientHeight - margin.top - margin.bottom) / 3;

      rects.each(function(d) {
        const rect = d3.select(this);
        const parent = d3.select(this.parentNode);
        const category = parent.attr("class").split(" ")[1];
        let categoryIndex = ["education", "work", "volunteering"].indexOf(category);
        if (categoryIndex === -1) categoryIndex = 0;

        const y = margin.top + (categoryIndex * timelineHeight) + 5;
        rect.attr("y", y);
      });
    }
    function highlightPositions(posIds) {
      document.querySelectorAll(".position-card").forEach((card) => {
        const cID = card.getAttribute("data-id");
        if (!posIds.includes(cID)) {
          card.classList.add("dimmed");
        } else {
          card.classList.remove("dimmed");
          card.classList.add("highlighted");
        }
      });
    }
    function unhighlightAllPositions() {
      document
        .querySelectorAll(".position-card")
        .forEach((card) => card.classList.remove("dimmed", "highlighted"));
    }
    function highlightSkillBubbles(skillNames) {
      const container = d3.select("#skill-tree-chart-container");
      container.selectAll(".skill-bubble").each(function (sd) {
        if (skillNames.includes(sd.id))
          d3.select(this).classed("hovered", true);
        else d3.select(this).classed("dimmed", true);
      });
    }
    function unhighlightAllSkills() {
      const container = d3.select("#skill-tree-chart-container");
      container
        .selectAll(".skill-bubble")
        .classed("hovered", false)
        .classed("dimmed", false);
    }
    function highlightAccomplishments(criteria) {
      document.querySelectorAll(".accomplishment-item").forEach((acc) => {
        const accPositions = (acc.getAttribute("data-positions") || "")
          .split(",")
          .map((s) => s.trim());
        const accSkills = (acc.getAttribute("data-skills") || "")
          .split(",")
          .map((s) => s.trim());
        const posMatch =
          criteria.positions &&
          criteria.positions.some((p) => accPositions.includes(p));
        const skillMatch =
          criteria.skills &&
          criteria.skills.some((s) => accSkills.includes(s));
        if (posMatch || skillMatch) acc.classList.add("hovered");
        else acc.classList.remove("hovered");
      });
    }
    function unhighlightAccomplishments() {
      document
        .querySelectorAll(".accomplishment-item")
        .forEach((acc) => acc.classList.remove("hovered"));
    }
    function initButtonBounceEffect() {
      document.querySelectorAll(".btn, .clipboard-btn").forEach((btn) => {
        btn.addEventListener("mousedown", () => {
          btn.style.transform = "scale(0.95)";
        });
        btn.addEventListener("mouseup", () => {
          btn.style.transform = "scale(1)";
        });
        btn.addEventListener("mouseleave", () => {
          btn.style.transform = "scale(1)";
        });
      });
    }
    function initClipboardHandlers() {
      document.querySelectorAll(".copyable").forEach((elem) => {
        const clipboardIcon =
          elem.parentElement.querySelector(".clipboard-btn");
        if (clipboardIcon) {
          clipboardIcon.addEventListener("mousedown", () => {
            clipboardIcon.style.transform = "scale(0.95)";
          });
          clipboardIcon.addEventListener("mouseup", () => {
            clipboardIcon.style.transform = "scale(1)";
            const text = elem.getAttribute("data-copy") || elem.textContent;
            copyTextToClipboard(text);
          });
        }
        elem.addEventListener("mousedown", () => {
          elem.style.transform = "scale(0.95)";
        });
        elem.addEventListener("mouseup", () => {
          elem.style.transform = "scale(1";
        });
      });
    }
    function copyTextToClipboard(text) {
      navigator.clipboard.writeText(text).then(() => {
        showToast(defaultConfig.translations[currentLanguage].clipboard_copied);
      });
    }
    function populateAccomplishments(accomplishments) {
      const container = document.getElementById("accomplishments-list");
      container.innerHTML = "";

      accomplishments.forEach((ac) => {
        const item = document.createElement("div");
        item.classList.add("accomplishment-item");
        item.setAttribute("data-positions", ac.positions.join(","));
        item.setAttribute("data-skills", ac.skills.join(","));
        item.dataset.acc = JSON.stringify(ac);

        let labelText = ac.translations?.[currentLanguage]?.label || ac.label;

        if (ac.attachment) {
          item.classList.add("has-attachment");
          const btn = document.createElement("a");
          btn.href = ac.attachment;
          btn.target = "_blank";
          btn.classList.add("btn", "btn-accomplishment");
          btn.innerHTML = `
            <span>${labelText}</span>
            <i class="bi bi-paperclip"></i>
          `;
          item.appendChild(btn);
        } else {
          item.innerHTML = `<span>${labelText}</span>`;
        }

        // Attach hover events for highlighting related items
        item.addEventListener("mouseenter", () => {
          item.classList.add("hovered");
          highlightPositions(ac.positions);
          highlightSkillBubbles(ac.skills);
        });

        item.addEventListener("mouseleave", () => {
          item.classList.remove("hovered");
          unhighlightAllPositions();
          unhighlightAllSkills();
        });

        container.appendChild(item);
      });
    }

    function initPositionHover() {
      document.querySelectorAll(".position-card").forEach((card) => {
        card.addEventListener("mouseenter", () => {
          const rect = document.querySelector(
            `.timeline-rect[data-id='${card.getAttribute("data-id")}']`
          );
          if (rect) rect.classList.add("hovered");
          const skillNames = (card.getAttribute("data-skills") || "")
            .split(",")
            .map((s) => s.trim())
            .filter(Boolean);
          highlightSkillBubbles(skillNames);
          highlightAccomplishments({
            positions: [card.getAttribute("data-id")],
            skills: skillNames,
          });
          document.querySelectorAll(".timeline-rect").forEach((r) => {
            if (r.getAttribute("data-id") !== card.getAttribute("data-id"))
              r.classList.add("dimmed");
          });
        });
        card.addEventListener("mouseleave", () => {
          const rect = document.querySelector(
            `.timeline-rect[data-id='${card.getAttribute("data-id")}']`
          );
          if (rect) rect.classList.remove("hovered");
          unhighlightAllSkills();
          unhighlightAccomplishments();
          document.querySelectorAll(".timeline-rect").forEach((r) => {
            r.classList.remove("dimmed");
          });
        });
      });
    }

    function simpleHash(str) {
      let hash = 0;
      for (let i = 0; i < str.length; i++) {
        hash = (hash << 5) - hash + str.charCodeAt(i); // Bitwise hash
        hash |= 0; // Convert to 32-bit integer
      }
      return Math.abs(hash); // Ensure positive value
    }

    function getProfileImage(email, yamlImage) {
      if (yamlImage) {
        return yamlImage; // Use the image from YAML if provided
      }

      if (email) {
        const emailHash = simpleHash(email.trim().toLowerCase());
        return `https://api.dicebear.com/7.x/identicon/svg?seed=${emailHash}`;
      }

      return "https://ui-avatars.com/api/?name=User&size=150"; // Default placeholder
    }
    // Import the passphrase as a CryptoKey using PBKDF2.
    async function importKey(passphrase) {
      const enc = new TextEncoder();
      const keyMaterial = await crypto.subtle.importKey(
        "raw",
        enc.encode(passphrase),
        { name: "PBKDF2" },
        false,
        ["deriveKey"]
      );
      if (!(keyMaterial instanceof CryptoKey)) {
        throw new Error(defaultConfig.translations[currentLanguage].invalid_key_material);
      }
      return keyMaterial;
    }

    // Derive an AES-GCM key from the passphrase and provided salt.
    async function deriveKey(passphrase, salt) {
      const keyMaterial = await importKey(passphrase);
      const derivedKey = await crypto.subtle.deriveKey(
        {
          name: "PBKDF2",
          salt: salt,
          iterations: 100000,
          hash: "SHA-256"
        },
        keyMaterial,
        { name: "AES-GCM", length: 256 },
        false,
        ["encrypt", "decrypt"]
      );
      console.log("Derived key:", derivedKey);
      return derivedKey;
    }

    // Decrypt the encrypted YAML configuration.
    async function decryptText(encryptedData, passphrase) {
      try {
        const data = JSON.parse(encryptedData);
        const salt = Uint8Array.from(atob(data.salt), c => c.charCodeAt(0));
        const iv = Uint8Array.from(atob(data.iv), c => c.charCodeAt(0));
        const ciphertext = Uint8Array.from(atob(data.ciphertext), c => c.charCodeAt(0));
        const key = await deriveKey(passphrase, salt);
        const decryptedBuffer = await crypto.subtle.decrypt(
          { name: "AES-GCM", iv: iv },
          key,
          ciphertext
        );
        const result = new TextDecoder().decode(decryptedBuffer);
        if (!result) {
          throw new Error(defaultConfig.translations[currentLanguage].empty_decryption_result);
        }
        return result;
      } catch (error) {
        showToast(defaultConfig.translations[currentLanguage].decryption_error.replace("{error}", error.message), "danger");
        throw error;
      }
    }

    // Initialize passphrase UI and handler
    function initPassphraseHandler() {
      const toggleBtn = document.getElementById("toggle-passphrase");
      const passInput = document.getElementById("passphrase-input");
      toggleBtn.addEventListener("click", function () {
        if (passInput.type === "password") {
          passInput.type = "text";
          toggleBtn.innerHTML = '<i class="bi bi-eye-slash"></i>';
        } else {
          passInput.type = "password";
          toggleBtn.innerHTML = '<i class="bi bi-eye"></i>';
        }
      });
      // Also allow hitting "Enter" to trigger submit
      passInput.addEventListener("keypress", function (event) {
        if (event.key === "Enter") {
          event.preventDefault();
          document.getElementById("passphrase-submit").click();
        }
      });
      // On clicking the Unlock button, try to decrypt the YAML
      document.getElementById("passphrase-submit").addEventListener("click", async function () {
        const passphrase = passInput.value.trim();
        if (!passphrase) {
          showToast(defaultConfig.translations[currentLanguage].passphrase_required, "warning");
          return;
        }
        const encryptedYAML = document.getElementById("custom-config").textContent.trim();
        let decryptedYAML;
        try {
          decryptedYAML = await decryptText(encryptedYAML, passphrase);
          if (!decryptedYAML) {
            throw new Error("Empty decryption result. Possibly an incorrect passphrase.");
          }
        } catch (error) {
          showToast(defaultConfig.translations[currentLanguage].decryption_failed.replace("{error}", error.message), "danger");
          return;
        }
        try {
          const newConfig = jsyaml.load(decryptedYAML);
          config = newConfig;
          if (config.page_title) document.title = config.page_title;
          if (config.cv_timestamp) document.getElementById("cv-timestamp").textContent = "Created: " + config.cv_timestamp;
          populatePersonalInfo(config.personal_info);
          populatePositions(config.positions);
          populateSkills(config.skills);
          populateAccomplishments(config.accomplishments);
          updateTranslations();
          initTimeline();
          initPositionHover();
          showToast(defaultConfig.translations[currentLanguage].decryption_success, "success");
        } catch (error) {
          showToast(defaultConfig.translations[currentLanguage].yaml_parse_failed.replace("{error}", error.message), "danger");
        }
      });
    }

    function getPassphraseFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      const passphrase = urlParams.get('p');
      if (passphrase) {
        // Remove the parameter from URL to avoid sharing
        window.history.replaceState({}, '', window.location.pathname);
        return decodeURIComponent(passphrase);
      }
      return null;
    }

    function getLanguageFromURL() {
      const urlParams = new URLSearchParams(window.location.search);
      const lang = urlParams.get('l');
      if (lang === 'de' || lang === 'en') {
        window.history.replaceState({}, '', window.location.pathname);
        return lang;
      }
      return null;
    }

    function initCV() {
      const defaultText = document.getElementById("default-config").textContent;
      defaultConfig = jsyaml.load(defaultText);
      config = defaultConfig;

      // Check for language parameter first
      const urlLang = getLanguageFromURL();
      if (urlLang) {
        currentLanguage = urlLang;
      }

      // Then check for passphrase
      const urlPassphrase = getPassphraseFromURL();
      if (urlPassphrase) {
        const passInput = document.getElementById("passphrase-input");
        passInput.value = urlPassphrase;
        setTimeout(() => {
          document.getElementById("passphrase-submit").click();
        }, 100);
      }

      if (config.page_title) document.title = config.page_title;
      if (config.cv_timestamp)
        document.getElementById("cv-timestamp").textContent =
          "Created: " + config.cv_timestamp;
      populatePersonalInfo(config.personal_info);
      populatePositions(config.positions);
      populateSkills(config.skills);
      populateAccomplishments(config.accomplishments);
      populatePreferences(config.preferences);
      updateTranslations();
      initTimeline();
      initPositionHover();
      initClipboardHandlers();
      initButtonAnimations();
      initPassphraseHandler();
      showToast(defaultConfig.translations[currentLanguage].viewing_example_cv, "blue", 2000, 10000);
    }

    // Calculate perceived brightness of a color
    function getColorBrightness(color) {
      const rgb = d3.rgb(color);
      // Using relative luminance formula
      return (0.299 * rgb.r + 0.587 * rgb.g + 0.114 * rgb.b) / 255;
    }

    // Determine text color based on background brightness
    function getContrastingTextColor(backgroundColor) {
      const brightness = getColorBrightness(backgroundColor);
      return brightness > 0.6 ? '#000000' : '#ffffff';
    }

    function populatePreferences(preferences) {
      const container = d3.select("#preferences-chart-container");
      container.selectAll("*").remove();

      // Create container div for the visualization
      const vizContainer = container.append("div")
      .attr("class", "preferences-viz-container");

      // Add view switch after the visualization
      const switchContainer = container.append("div")
      .attr("id", "preferences-view-switch")
      .attr("class", "form-check card p-1");

      switchContainer.html(`
      <input class="form-check-input" type="checkbox" id="preferences-view-toggle">
      <label class="form-check-label" for="preferences-view-toggle">
        Bar Chart View
      </label>
      `);

      // Only add the switch in normal mode (not in high-contrast)
      if (document.body.classList.contains("high-contrast")) {
        switchContainer.style("display", "none");
      }

      d3.select("#preferences-view-toggle").on("change", function () {
        renderPreferences(preferences, this.checked, vizContainer);
        updateTranslations();
      });

      // Initial render with treemap
      renderPreferences(preferences, false, vizContainer);
      updateTranslations();
    }

    function renderPreferences(preferences, isBarChart, container) {
      container.selectAll("*").remove();
      const width = container.node().clientWidth;
      const height = width * 1;

      // Helper function to get translated text
      const getTranslatedText = (item) =>
        item.translations && item.translations[currentLanguage]
          ? item.translations[currentLanguage]
          : item.id;

      // Get tooltip element
      let tooltip = d3.select("#preferences-tooltip");

      // Add tooltip handlers
      const showTooltip = (event, d) => {
        const data = d.data || d;
        const level = data.level || data.originalData?.level;
        const name = getTranslatedText(data.originalData || data);

        tooltip.html(`
            ${name}<br>
            ${config.translations[currentLanguage].preferences_level || 'Level'}: ${level}/10
        `)
        .style("opacity", 1)
        .style("left", (event.pageX + 10) + "px")
        .style("top", (event.pageY + 10) + "px");
      };

      const moveTooltip = (event) => {
        tooltip
            .style("left", (event.pageX + 10) + "px")
            .style("top", (event.pageY + 10) + "px");
      };

      const hideTooltip = () => {
        tooltip.style("opacity", 0);
      };

      if (isBarChart) {
        const margin = { top: 5, right: 5, bottom: 5, left: 5 };
        const paddingText = { left: 5 };
        const barHeight = 30;
        const chartHeight = barHeight * preferences.length + margin.top + margin.bottom;

        const svg = container.append("svg")
          .attr("class", "preferences-container")
          .attr("height", chartHeight);

        const x = d3.scaleLinear()
          .domain([0, d3.max(preferences, d => d.level)])
          .range([margin.left, width - margin.right]);

        const colorScale = d3.scaleSequential()
          .domain([0, 10])
          .interpolator(d3.interpolateRgb(
            getComputedStyle(document.documentElement).getPropertyValue('--highlight-1'),
            getComputedStyle(document.documentElement).getPropertyValue('--highlight-12')
          ));

        const groups = svg.selectAll("g")
          .data(preferences)
          .enter()
          .append("g")
          .attr("class", "preferences-bar-group")
          .attr("transform", (d, i) => `translate(0,${margin.top + i * barHeight})`);

        groups.each(function (d) {
          const g = d3.select(this);
          const backgroundColor = colorScale(d.level);
          const textColor = getContrastingTextColor(backgroundColor);

          g.append("rect")
            .attr("class", "preference-bar-rect")
            .attr("x", margin.left)
            .attr("y", 2)
            .attr("width", x(d.level) - margin.left)
            .attr("height", barHeight - 4)
            .style("fill", backgroundColor);

          g.append("text")
            .attr("class", "preferences-bar-text")
            .attr("x", margin.left + paddingText.left)
            .attr("y", barHeight / 2)
            .style("fill", textColor)
            .text(getTranslatedText(d));
        });

        // Add tooltip handlers to bar chart
        groups.each(function(d) {
          const g = d3.select(this);
          g.on("mouseenter", (e) => showTooltip(e, d))
            .on("mousemove", moveTooltip)
            .on("mouseleave", hideTooltip);
        });
      } else {
        const svg = container.append("svg")
          .attr("class", "preferences-container preferences-treemap")
          .attr("height", height);

        const treemapData = {
          name: "preferences",
          children: preferences.map(d => ({
            name: getTranslatedText(d),
            value: Math.pow(2, d.level),
            level: d.level,
            originalData: d
          }))
        };

        const treemapLayout = d3.treemap()
          .size([width, height])
          .padding(8)
          .round(true);

        const root = d3.hierarchy(treemapData)
          .sum(d => d.value);

        treemapLayout(root);

        const colorScale = d3.scaleSequential()
          .domain([0, 10])
          .interpolator(d3.interpolateRgb(
            getComputedStyle(document.documentElement).getPropertyValue('--highlight-1'),
            getComputedStyle(document.documentElement).getPropertyValue('--highlight-12')
          ));

        const cells = svg.selectAll("g")
          .data(root.leaves())
          .enter()
          .append("g")
          .attr("class", "preferences-treemap-cell")
          .attr("transform", d => `translate(${d.x0},${d.y0})`);

        let enhancedCell = null;

        cells.each(function (d) {
          const cell = d3.select(this);
          const backgroundColor = colorScale(d.data.level);
          const textColor = getContrastingTextColor(backgroundColor);

          cell.append("rect")
            .attr("width", d => Math.max(0, d.x1 - d.x0))
            .attr("height", d => Math.max(0, d.y1 - d.y0))
            .style("fill", backgroundColor);

          // Add text truncation for treemap cells
          const cellWidth = d.x1 - d.x0;
          const cellHeight = d.y1 - d.y0;

          const foreignObject = cell.append("foreignObject")
            .attr("width", cellWidth)
            .attr("height", cellHeight);

          const textDiv = foreignObject.append("xhtml:div")
            .attr("class", "preferences-text-wrapper")
            .style("color", textColor)
            .text(d.data.name);
        });

        // Add tooltip handlers to treemap cells
        cells.each(function(d) {
          const cell = d3.select(this);
          cell.on("mouseenter", (e) => showTooltip(e, d))
              .on("mousemove", moveTooltip)
              .on("mouseleave", hideTooltip);
        });
      }
    }

    // Consolidate button animations
    function initButtonAnimations() {
      const elements = document.querySelectorAll('.btn, .btn-animate, .badge');
      elements.forEach(addButtonAnimation);
    }

    // Add new utility function for button animation
    function addButtonAnimation(element) {
      element.classList.add('btn-animate');
    }

    let currentLanguage = "en";
    let config = null;
    let defaultConfig = null;
    let selectedSkill = null;
    let disableSkillAnimation = false;

    document.addEventListener("DOMContentLoaded", initCV);
    document.addEventListener("click", function (event) {
      if (!event.target.closest(".skill-bubble") && selectedSkill !== null) {
        selectedSkill = null;
        d3.selectAll(".skill-bubble").classed("selected", false);
        document.querySelectorAll(".position-card").forEach((card) => {
          card.classList.remove("dimmed", "highlighted");
        });
        showToastSkillFilter("");
      }
    });
    let resizeTimer;
    window.addEventListener("resize", () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        initSkillTree();
        initTimeline();
        populatePreferences(config.preferences);
      }, 200);
    });
    /*]]>*/
  </script>
</body>

</html>
